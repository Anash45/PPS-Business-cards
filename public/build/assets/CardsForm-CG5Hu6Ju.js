import{u as N,r as n,j as a,I as r,S as v,T as m,C as y,b,E as u,d as q}from"./app-B8v70Kz_.js";import{g as w}from"./viteConfig-gEqUb4HH.js";import C from"./CardsPreview-CrOOHPBF.js";import"./dayjs.min-DbXp6Z5d.js";function D({previewCards:f,setPreviewCards:d}){const{companies:c}=N().props,[o,x]=n.useState("https://app.ppsbusinesscards.de"),[p,_]=n.useState(!1),[t,i]=n.useState({company_id:c.length>0?c[0].id:"",quantity:10,nfc_quantity:50,domain:o}),[l,g]=n.useState({used_cards:0,total_cards_allowed:0,remaining_cards:0,nfc_used:0,total_nfc_cards:0,nfc_remaining:0});n.useEffect(()=>{(async()=>{const e=await w();x(e),i(s=>({...s,domain:e}))})()},[]),n.useEffect(()=>{const e=c.find(s=>s.id===parseInt(t.company_id));e&&g({used_cards:e.used_cards,total_cards_allowed:e.total_cards_allowed,remaining_cards:e.remaining_cards,nfc_used:e.nfc_used,total_nfc_cards:e.total_nfc_cards,nfc_remaining:e.nfc_remaining})},[t.company_id,c]);const h=()=>d([]),j=async e=>{e.preventDefault(),_(!0),d([]);try{const s=await b.post("/cards",{company_id:t.company_id,quantity:t.quantity,nfc_quantity:t.nfc_quantity});console.log("Cards: ",s.data),s.data.success?(d(s.data.createdNfcCards),u.success(`${s.data.cards_created} cards generated successfully!`),q.reload({only:["cardsGroups","companies"]})):u.error(s.data.message||"Failed to generate cards")}catch(s){console.error(s),u.error(s.response?.data?.message||"Failed to generate cards")}finally{_(!1)}};return a.jsxs(a.Fragment,{children:[a.jsxs("form",{onSubmit:j,className:"grid gap-3 md:grid-cols-2 grid-cols-1",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(r,{htmlFor:"company",value:"Company",className:"text-[#344054] font-medium"}),a.jsx(v,{id:"company",name:"company_id",value:t.company_id,onChange:e=>i({...t,company_id:e.target.value}),className:"w-full block",options:c.map(e=>({value:e.id,label:e.name}))})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[a.jsx(r,{htmlFor:"quantity",value:"Number of employees",className:"text-[#344054] font-medium leading-tight"}),a.jsxs("span",{className:"text-xs font-semibold text-[#344054] leading-tight",children:["(",l.used_cards,"/",l.total_cards_allowed,")"]})]}),a.jsx(m,{id:"quantity",name:"quantity",type:"number",value:t.quantity,onChange:e=>i({...t,quantity:e.target.value}),className:"block w-full",required:!0})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[a.jsx(r,{htmlFor:"nfc_quantity",value:"Number of NFC cards",className:"text-[#344054] font-medium leading-tight"}),a.jsxs("span",{className:"text-xs font-semibold text-[#344054] leading-tight",children:["(",l.nfc_used,"/",l.total_nfc_cards,")"]})]}),a.jsx(m,{id:"nfc_quantity",name:"nfc_quantity",type:"number",value:t.nfc_quantity,onChange:e=>i({...t,nfc_quantity:e.target.value}),className:"block w-full",required:!0})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(r,{htmlFor:"domain",value:"Domain (read-only)",className:"text-[#344054] font-medium"}),a.jsx(m,{id:"domain",name:"domain",value:o,readOnly:!0,className:"block w-full"})]}),a.jsxs("div",{className:"flex-wrap gap-1 items-center md:col-span-2 flex mt-3",children:[a.jsx(y,{type:"submit",disabled:p,children:p?"Generating...":"Generate Cards"}),a.jsx(y,{variant:"light",type:"button",onClick:h,children:"Clear Preview"})]})]}),f.length>0&&a.jsx(C,{domain:o,previewCards:f})]})}export{D as default};
