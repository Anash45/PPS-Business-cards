import{r as d,j as a,B as j,b as y,c as w,H as C,d as D,e as S,z as i,f as $}from"./app-DFcEJYgF.js";import{A as k}from"./AuthenticatedLayout-DcV9LOxy.js";import{E as h,D as A}from"./dataTables.dataTables-DBE6_Kmi.js";import{D as E,a as b}from"./DropdownUi-DXO6iUvj.js";import{g as N}from"./viteConfig-BIBuROsR.js";import{c as L}from"./csvFieldDefinitions-CmBVwms9.js";import"./ApplicationLogo-CDcR_Pa_.js";function _({cards:c}){const[l,u]=d.useState(!1),p=async()=>{if(c?.length){u(!0);try{const n=L.map(s=>s.name),f=c.map(s=>n.map((r,o)=>o===0&&s.code||"")),x=[n.join(","),...f.map(s=>s.map(e=>`"${e}"`).join(","))].join(`
`),g=new Blob([x],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(g),t=document.createElement("a");t.href=m,t.download="base_sample.csv",t.click(),URL.revokeObjectURL(m)}catch(n){console.error("CSV generation failed:",n)}finally{u(!1)}}};return a.jsx("div",{className:"flex justify-end",children:a.jsx(j,{onClick:p,disabled:l,children:l?"Saving...":"Download Base CSV"})})}h.use(A);function M(){const{cards:c,isSubscriptionActive:l}=y().props,{setHeaderTitle:u,setHeaderText:p}=w(),[n,f]=d.useState("https://app.ppsbusinesscards.de");d.useEffect(()=>{(async()=>{const t=await N();f(t),console.log("asdsad",t)})()},[]),d.useEffect(()=>{u("Cards Management"),p("")},[]);const x=(t,s,e)=>{const r=document.createElement("div");return setTimeout(()=>{D.createRoot(r).render(a.jsxs(E,{children:[a.jsx(b,{onClick:()=>window.location.href=`/company/cards/${e.id}/edit`,children:"Edit"}),a.jsx(b,{onClick:()=>g(e.id,e.status),children:e.status==="active"?"Set Inactive":"Set Active"})]}))},0),r},g=async(t,s)=>{const e=s==="active"?"inactive":"active";if(confirm(`Are you sure you want to set this card as ${e}?`))try{const r=await S.put(`/cards/${t}/toggle-status`,{status:e});r.data?.success?(i.success(r.data.message||"Card status updated successfully."),$.reload({only:["cards"]})):i.error(r.data?.message||"Failed to update card status.")}catch(r){if(r.response&&r.response.data){const o=r.response.data;o.message?i.error(o.message):o.errors?Object.values(o.errors).forEach(v=>{i.error(v)}):i.error("An unexpected error occurred.")}else i.error("Network error or server is unreachable.")}},m=d.useMemo(()=>[{title:"ID",data:"id"},{title:"Code",data:"code",render:(t,s,e)=>`<a href="${n}/card/${t}" target="_blank" class="text-[#50bd5b] underline">${t}</a>`},{title:"User",data:null,render:(t,s,e)=>{const o=[e.salutation,e.title,e.first_name,e.last_name].filter(Boolean).join(" ");return`<div class="flex items-center gap-2">
                        <img
                            src="${e.profile_image?`/storage/${e.profile_image}`:"/assets/images/profile-placeholder.svg"}"
                            alt="Profile"
                            class="rounded-full border-2 bg-white border-white w-8 h-8 object-cover shrink-0"
                        />
                        <div>
                            <p class="font-medium text-[#181D27] text-sm">${o||"Not assigned"}</p>
                        </div>
                    </div>`}},{title:"Position",data:"position"},{title:"Department",data:"department"},{title:"Status",data:"status",render:t=>{const s=t==="active";return`<span class="px-2 py-1 text-xs font-medium rounded-full ${s?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"}">${s?"Active":"Inactive"}</span>`}},{title:"Actions",data:null,orderable:!1,searchable:!1,render:x}],[n]);return a.jsxs(k,{children:[a.jsx(C,{title:"Cards"}),a.jsxs("div",{className:"py-4 md:px-6 px-4 flex flex-col gap-6",children:[a.jsx(_,{cards:c}),l?a.jsx("div",{className:"space-y-5",children:a.jsx("div",{className:"py-4 md:px-6 px-4 rounded-[14px] bg-white flex flex-col gap-3",children:a.jsx(h,{data:c,columns:m,className:"display site-datatable",options:{responsive:!0,pageLength:10,lengthMenu:[10,25,50,100],dom:"<'flex justify-between items-center mb-3 sd-top'<'flex items-center gap-2'l><'flex items-center gap-2'f>>rt<'flex justify-center mt-3 sd-bottom'p>"}},n)})}):a.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-md",children:"You can only access this page with a valid subscription. Contact Admin for more information."})]})]})}export{M as default};
