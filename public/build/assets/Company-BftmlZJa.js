import{r as l,j as a,B as b,b as P,c as O,H,d as M,e as I,z as u,f as N}from"./app-C5Glw27R.js";import{A as V}from"./AuthenticatedLayout-DK1_TDkT.js";import{E as T,D as q}from"./dataTables.dataTables-C1pvo7--.js";import{D as F,a as R}from"./DropdownUi-ClR7ne4m.js";import{g as z}from"./viteConfig-BIBuROsR.js";import{c as B}from"./csvFieldDefinitions-CmBVwms9.js";import"./ApplicationLogo-BcCoRMqT.js";function G({cards:p}){const[g,x]=l.useState(!1),y=async()=>{if(p?.length){x(!0);try{const i=B.map(o=>o.name),j=p.map(o=>i.map((S,C)=>C===0&&o.code||"")),k=[i.join(","),...j.map(o=>o.map(h=>`"${h}"`).join(","))].join(`
`),w=new Blob([k],{type:"text/csv;charset=utf-8;"}),v=URL.createObjectURL(w),f=document.createElement("a");f.href=v,f.download="base_sample.csv",f.click(),URL.revokeObjectURL(v)}catch(i){console.error("CSV generation failed:",i)}finally{x(!1)}}};return a.jsx("div",{className:"flex justify-end",children:a.jsx(b,{onClick:y,disabled:g,children:g?"Saving...":"Download Base CSV"})})}T.use(q);function te(){const{cards:p,isSubscriptionActive:g}=P().props,{setHeaderTitle:x,setHeaderText:y}=O(),[i,j]=l.useState("https://app.ppsbusinesscards.de");l.useEffect(()=>{(async()=>{const t=await z();j(t),console.log("asdsad",t)})()},[]),l.useEffect(()=>{x("Cards Management"),y("")},[]);const k=(t,n,e)=>{const s=document.createElement("div");return setTimeout(()=>{M.createRoot(s).render(a.jsxs(F,{children:[a.jsx(R,{onClick:()=>window.location.href=`/company/cards/${e.id}/edit`,children:"Edit"}),a.jsx(R,{onClick:()=>w(e.id,e.status),children:e.status==="active"?"Set Inactive":"Set Active"})]}))},0),s},w=async(t,n)=>{const e=n==="active"?"inactive":"active";if(confirm(`Are you sure you want to set this card as ${e}?`))try{const s=await I.put(`/cards/${t}/toggle-status`,{status:e});s.data?.success?(u.success(s.data.message||"Card status updated successfully."),N.reload({only:["cards"]})):u.error(s.data?.message||"Failed to update card status.")}catch(s){if(s.response&&s.response.data){const r=s.response.data;r.message?u.error(r.message):r.errors?Object.values(r.errors).forEach(d=>{u.error(d)}):u.error("An unexpected error occurred.")}else u.error("Network error or server is unreachable.")}},[v,f]=l.useState(!1),[o,h]=l.useState([]),S=l.useMemo(()=>[{title:'<input type="checkbox" id="select-all" /> ID',data:"id",orderable:!1,render:(t,n,e)=>{const s=o.includes(e.id);return`
        <div class="flex items-center gap-2">
            <input type="checkbox" 
                   class="row-checkbox" 
                   value="${e.id}" 
                   ${s?"checked":""} />
            <span>${e.id}</span>
        </div>
    `}},{title:"Code",data:"code",render:(t,n,e)=>`<a href="${i}/card/${t}" target="_blank" class="text-[#50bd5b] underline">${t}</a>`},{title:"User",data:null,render:(t,n,e)=>{const r=[e.salutation,e.title,e.first_name,e.last_name].filter(Boolean).join(" ");return`
                    <div class="flex items-center gap-2">
                        <img
                            src="${e.profile_image?`/storage/${e.profile_image}`:"/assets/images/profile-placeholder.png"}"
                            alt="Profile"
                            class="rounded-full border-2 bg-white border-white w-8 h-8 object-cover shrink-0"
                        />
                        <div>
                            <p class="font-medium text-[#181D27] text-sm">
                                ${r||"Not assigned"}
                            </p>
                        </div>
                    </div>
                `}},{title:"Position",data:"position"},{title:"Department",data:"department"},{title:"Status",data:"status",render:t=>{const n=t==="active";return`<span class="px-2 py-1 text-xs font-medium rounded-full ${n?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"}">
                    ${n?"Active":"Inactive"}
                </span>`}},{title:"Actions",data:null,orderable:!1,searchable:!1,render:k}],[i]);l.useEffect(()=>{const t=document.getElementById("select-all");if(!t)return;const n=s=>{const r=s.target.checked,d=document.querySelectorAll(".row-checkbox"),m=[];d.forEach(c=>{c.checked=r,r&&m.push(parseInt(c.value))}),h(r?m:[]),f(r)},e=()=>{const s=document.querySelectorAll(".row-checkbox"),r=Array.from(document.querySelectorAll(".row-checkbox:checked")),d=r.map(m=>parseInt(m.value));t.checked=r.length===s.length,h(d),f(d.length>0)};return t.addEventListener("change",n),document.addEventListener("change",s=>{s.target.classList.contains("row-checkbox")&&e()}),()=>{t.removeEventListener("change",n)}},[i]);const[C,A]=l.useState(!1),U=async()=>{if(!(!p?.length||!o?.length)){console.log(p,o),A(!0);try{const t=B.map(c=>c.name),e=p.filter(c=>o.includes(c.id)).map(c=>t.map((Y,_)=>_===0&&c.code||"")),s=[t.join(","),...e.map(c=>c.map(L=>`"${L}"`).join(","))].join(`
`),r=new Blob([s],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(r),m=document.createElement("a");m.href=d,m.download="base_sample.csv",m.click(),URL.revokeObjectURL(d)}catch(t){console.error("CSV generation failed:",t)}finally{A(!1)}}},[E,D]=l.useState(!1),$=async t=>{if(!o.length){u.warning("Please select at least one card.");return}D(!0);try{const n=await I.post("/cards/toggle-multiple-status",{ids:o,status:t});u.success(n.data.message),N.reload({only:["cards"]}),typeof refreshTable=="function"&&refreshTable()}catch(n){console.error("Toggle failed:",n);const e=n.response?.data?.message||"Failed to update status.";u.error(e)}finally{D(!1)}};return a.jsxs(V,{children:[a.jsx(H,{title:"Cards"}),a.jsxs("div",{className:"py-4 md:px-6 px-4 flex flex-col gap-6",children:[a.jsx(G,{cards:p}),g?a.jsx("div",{className:"space-y-5",children:a.jsxs("div",{className:"py-4 md:px-6 px-4 rounded-[14px] bg-white flex flex-col gap-3 space-y-3",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[a.jsx(b,{onClick:()=>$("active"),disabled:!o.length||E,variant:"primary-outline",children:"Set Active"}),a.jsx(b,{onClick:()=>$("inactive"),disabled:!o.length||E,variant:"danger-outline",children:"Set Inactive"}),a.jsx(b,{onClick:U,variant:"light",disabled:!v,children:C?"Saving...":"Download Base CSV"})]}),o.length>0?a.jsxs("p",{className:"text-sm text-primary",children:[o.length," cards selected"]}):null]}),a.jsx(T,{data:p,columns:S,className:"display site-datatable",options:{responsive:!0,pageLength:10,lengthMenu:[10,25,50,100],dom:"<'flex justify-between items-center mb-3 sd-top'<'flex items-center gap-2'l><'flex items-center gap-2'f>>rt<'flex justify-center mt-3 sd-bottom'p>"}},i)]})}):a.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-md",children:"You can only access this page with a valid subscription. Contact Admin for more information."})]})]})}export{te as default};
