import{j as n,a as u,r as f,E as D,b as v}from"./app-PKz9FedL.js";import{g as R}from"./viteConfig-gEqUb4HH.js";import{u as x}from"./AutoTranslateProvider-DhrNfTV5.js";function z({cardSocialsLinks:o}){return o?.length?n.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-center",children:(o||[]).map((l,i)=>l.url&&n.jsx("a",{href:l.url||"#",target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 hover:text-gray-700 transition",children:l.icon?n.jsx("img",{src:`/assets/images/icons/${l.icon.replace(/^Fa/,"").toLowerCase()}.png`,alt:l.icon,className:"h-7"}):null},i))}):null}function C(){const{cardFormData:o}=u(),i=x()?.isDE||null,[e,t]=f.useState("https://app.ppsbusinesscards.de");f.useEffect(()=>{(async()=>{const d=await R();t(d)})()},[]);const a=async()=>{if(!o)return;console.log("cardFormData: ",o);const d=o.first_name||"",m=o.last_name||"",b=o.company_name||"";let _=`BEGIN:VCARD
VERSION:3.0
N:${m};${d};;${o.title||""};
FN:${[o.salutation,d,m].filter(Boolean).join(" ")}
ORG:${b}
TITLE:${i&&o.position_de?o.position_de:o.position||""}
ROLE:${i&&o.department_de?o.department_de:o.department||""}
`;if(o.profile_image_url)try{const s=await r(`${e}${o.profile_image_url}`);if(s){const g=c(o.profile_image_url);_+=`PHOTO;ENCODING=b;TYPE=${g}:${s}
`}}catch(s){console.warn("Failed to convert image to base64, falling back to URL:",s),_+=`PHOTO;VALUE=URI:${e}${o.profile_image_url}
`}(o.card_websites||[]).forEach(s=>{s.url&&(s.label?_+=`URL;TYPE=${s.label.toUpperCase()}:${s.url}
`:_+=`URL:${s.url}
`)}),_+=`URL;TYPE=Update vcard:${e}/card/${o.code}
`,(o.card_phone_numbers||[]).forEach((s,g)=>{if(s.phone_number){const y=(s.type||"Work").toUpperCase();_+=`TEL;TYPE=${g===0?"PREF,":""}${y},VOICE:${s.phone_number}
`}}),(o.card_emails||[]).forEach((s,g)=>{if(s.email){const y=(s.type||"Work").toUpperCase();_+=`EMAIL;TYPE=${g===0?"PREF,":""}${y}:${s.email}
`}}),(o.card_addresses||[]).forEach((s,g)=>{if(s.street||s.house_number||s.city||s.country){const y=(s.type||"Work").toUpperCase(),j=g===0?"PREF,":"",E=[s.street,s.house_number].join(" "),$=s.city||"",P=s.zip||"",k=s.country||"";_+=`ADR;TYPE=${j}${y}:;;${E};${$};;${P};${k}
`}}),_+="END:VCARD";const h=new Blob([_],{type:"text/vcard;charset=utf-8"}),w=URL.createObjectURL(h),p=document.createElement("a"),N=b.replace(/\s+/g,"_");p.download=`${d}_${m}_${N}.vcf`,p.href=w,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(w),D.success("vCard downloaded!");try{const s=await v.post("/cards/increment-downloads",{code:o.code});s.data.success?console.log("Downloads updated:",s.data.downloads):console.warn("Download increment failed:",s.data.message)}catch(s){console.error("Error incrementing downloads:",s)}},r=d=>new Promise((m,b)=>{const _=new Image;_.crossOrigin="Anonymous",_.onload=()=>{const h=document.createElement("canvas"),w=h.getContext("2d");h.width=_.width,h.height=_.height,w.drawImage(_,0,0);try{const p=h.toDataURL("image/jpeg").split(",")[1];m(p)}catch(p){b(p)}},_.onerror=b,_.src=d,_.complete&&_.onload()}),c=d=>{const m=d.split(".").pop()?.toLowerCase()||"jpeg";return{jpg:"JPEG",jpeg:"JPEG",png:"PNG",gif:"GIF",bmp:"BMP",webp:"WEBP"}[m]||"JPEG"};return n.jsx("div",{className:"flex items-center justify-center",children:n.jsx("button",{onClick:a,style:{color:o?.vcard_btn_text_color||o?.btn_text_color||"#ffffff",backgroundColor:o?.vcard_btn_bg_color||o?.btn_bg_color||"#87B88C",borderColor:o?.vcard_btn_bg_color||o?.btn_bg_color||"#87B88C"},className:"px-4 py-2.5 rounded-[10px] text-sm font-medium leading-tight w-fit",children:i&&o.contact_btn_text_de?o.contact_btn_text_de:o.contact_btn_text})})}function A({cardPhones:o}){const i=x()?.isDE||null,{isCardReal:e,cardFormData:t}=u(),a=o?.filter(c=>!c.is_hidden),r=a&&a.length>0?a:[{icon:"ðŸ“ž",label:"Sample",phone_number:"+44 1234 567890",is_hidden:!1}];return n.jsx("div",{className:"grid gap-2 grid-cols-1",children:r.map((c,d)=>n.jsxs("a",{target:"_blank",href:`tel:${c.phone_number}`,style:{color:t?.phone_text_color??t?.btn_text_color,backgroundColor:t?.phone_bg_color??t?.btn_bg_color,borderColor:t?.phone_bg_color??t?.btn_bg_color,fontSize:`${t.buttons_size}px`},className:"flex relative border leading-tight items-center gap-3 justify-content-start rounded-lg px-4 py-2.5 font-medium preview-btn w-full",children:[c.icon?n.jsx("span",{className:"shrink-0",style:{fontSize:`${Number(t.buttons_size)+4}px`},children:c?.icon??"ðŸ“ž"}):null,n.jsxs("span",{children:[c.label||c.label_de?n.jsx("span",{children:i&&c.label_de?c.label_de:c.label}):null," ",c.phone_number]}),c.is_hidden&&n.jsx("span",{className:"absolute -translate-y-1/2 translate-x-1 top-0 right-0 text-[10px] rounded bg-orange-500 py-0.5 px-2 italic text-white",children:"(Hidden)"})]},d))})}function B({cardEmails:o}){const{cardFormData:l}=u(),e=x()?.isDE||null,t=o?.filter(r=>!r.is_hidden)||[],a=[];return t.length>0?a.push(...t):a.push({label:"Sample",label_de:"Probe",email:"sample@email.com",is_hidden:!1}),n.jsx("div",{className:"grid gap-2 grid-cols-1",children:a.map((r,c)=>n.jsxs("a",{target:"_blank",href:`mailto:${r.email}`,style:{color:l?.email_text_color??l?.btn_text_color,backgroundColor:l?.email_bg_color??l?.btn_bg_color,borderColor:l?.email_bg_color??l?.btn_bg_color,fontSize:`${l.buttons_size}px`},className:"flex border leading-tight relative items-center gap-3 justify-content-start rounded-lg px-4 py-2.5 font-medium preview-btn",children:[n.jsx("span",{className:"shrink-0",style:{fontSize:`${Number(l.buttons_size)+4}px`},children:"âœ‰ï¸"}),n.jsxs("span",{children:[(r.label||r.label_de)&&n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"block",children:e&&r.label_de?r.label_de:r.label})," "]}),r.email]})]},c))})}function S({cardWebsites:o}){const i=x()?.isDE||null,{cardFormData:e}=u(),t=o?.filter(a=>!a.is_hidden);return t?.length?n.jsx("div",{className:"grid gap-2 grid-cols-1",children:t.map((a,r)=>n.jsxs("a",{href:a.url?.startsWith("http")?a.url:`https://${a.url}`,target:"_blank",rel:"noopener noreferrer",style:{color:e?.website_text_color??e?.btn_text_color,backgroundColor:e?.website_bg_color??e?.btn_bg_color,borderColor:e?.website_bg_color??e?.btn_bg_color,fontSize:`${e.buttons_size}px`},className:"flex border leading-tight relative items-center gap-3 justify-start rounded-lg px-4 py-2.5 font-medium preview-btn",children:[a.icon?n.jsx("span",{className:"shrink-0",style:{fontSize:`${Number(e.buttons_size)+4}px`},children:n.jsx("span",{children:a.icon})}):null,n.jsx("span",{className:"truncate",children:a.label||a.label_de?n.jsx("span",{children:i&&a.label_de?a.label_de:a.label}):a.url}),a.is_hidden?n.jsx("span",{className:"absolute -translate-y-1/2 translate-x-1 top-0 right-0 text-[10px] rounded bg-orange-500 py-0.5 px-2 italic text-white",children:"(Hidden)"}):null]},r))}):null}function L({cardAddresses:o}){const{isCardReal:l,cardFormData:i}=u(),t=x()?.isDE||null,a=o?.filter(r=>!r.is_hidden);return a?.length>0?n.jsx("div",{className:"grid gap-2 grid-cols-1",children:a.map((r,c)=>r.is_hidden&&l?null:n.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:r.map_link||`https://www.google.de/maps/search/?api=1&query=${encodeURIComponent([r.street,r.house_number,r.zip,r.city,r.country].filter(Boolean).join(" "))}`,style:{color:i?.address_text_color??i?.btn_text_color,backgroundColor:i?.address_bg_color??i?.btn_bg_color,borderColor:i?.address_bg_color??i?.btn_bg_color,fontSize:`${i.buttons_size}px`},className:"flex border leading-tight relative items-center gap-3 justify-content-start rounded-lg px-4 py-2.5 font-medium preview-btn",children:[n.jsx("span",{className:"shrink-0",style:{fontSize:`${Number(i.buttons_size)+4}px`},children:"ðŸ“"}),n.jsx("span",{children:r.label||r.label_de?n.jsx("span",{children:t&&r.label_de?r.label_de:r.label}):n.jsxs("span",{children:[[r.street,r.house_number].filter(Boolean).join(" "),r.street||r.house_number?", ":"",[r.zip,r.city].filter(Boolean).join(" "),r.zip||r.city?", ":"",r.country||""]})}),r.is_hidden?n.jsx("span",{className:"absolute -translate-y-1/2 translate-x-1 top-0 right-0 text-[10px] rounded bg-orange-500 py-0.5 px-2 italic text-white",children:"(Hidden)"}):null]},c))}):null}function F({cardButtons:o}){const i=x()?.isDE||null,{cardFormData:e}=u();return o?.length>0?n.jsx("div",{className:"grid gap-2 grid-cols-1",children:o.map((t,a)=>t.button_text&&n.jsxs("a",{target:"_blank",href:t.button_link,style:{color:e?.btn_text_color,backgroundColor:e?.btn_bg_color,borderColor:e?.btn_bg_color??"#87B88C",fontSize:`${e.buttons_size}px`},className:"flex border leading-tight items-center gap-3 justify-content-start rounded-lg px-4 py-2.5 font-medium preview-btn",children:[t.icon?n.jsx("span",{className:"shrink-0",style:{fontSize:`${Number(e.buttons_size)+4}px`},children:t.icon}):null,n.jsx("span",{children:i&&t.button_text_de?t.button_text_de:t.button_text})]},a))}):null}function T(){const{cardFormData:o,cardSectionsOrder:l,setCardSectionsOrder:i}=u(),e=["phoneNumbers","emails","websites","addresses","buttons"];f.useEffect(()=>{o?.company_id&&(l&&l.length>0||v.get(`/company/${o.company_id}/card-sections-order`).then(r=>{r.data.order&&Array.isArray(r.data.order)?i(r.data.order):i(e)}).catch(r=>{console.warn("âš ï¸ Failed to fetch card section order:",r),i(e)}))},[o?.company_id]);const t={phoneNumbers:n.jsx(A,{cardPhones:o?.card_phone_numbers??[]},"phoneNumbers"),emails:n.jsx(B,{cardEmails:o?.card_emails??[]},"emails"),websites:n.jsx(S,{cardWebsites:o?.card_websites??[]},"websites"),addresses:n.jsx(L,{cardAddresses:o?.card_addresses??[]},"addresses"),buttons:n.jsx(F,{cardButtons:o?.card_buttons??[]},"buttons")},a=l?.length?l:e;return n.jsx("div",{className:"space-y-2",children:a.map(r=>t[r]??null)})}function W({isReal:o=!1}){const i=x()?.isDE||null,{cardFormData:e}=u(),t=f.useRef(null),a=f.useRef(null),[r,c]=f.useState(!0);return f.useEffect(()=>{const d=()=>{if(t.current&&a.current){const m=t.current.getBoundingClientRect(),b=a.current.getBoundingClientRect();c(Math.abs(m.top-b.top)<5)}};return d(),window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[e?.position,e?.department]),n.jsx("div",{className:`border ${o?"border-transparent":"border-[#EAECF0]"} rounded-lg p-3 mx-auto w-[430px] max-w-full`,style:{backgroundColor:e?.card_bg_color??"#ffffff"},children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"relative border border-[#EAECF0] bg-gradient bg-gradient-to-b from-[#eaffec] to-transparent rounded-lg w-full",children:[e.banner_image_url?n.jsx("img",{src:e.banner_image_url,alt:"Banner",className:"w-full h-full object-cover rounded-lg aspect-[2/1]"}):n.jsx("img",{src:"/assets/images/white-placeholder.webp",alt:"Banner",className:"w-full h-full object-cover rounded-lg aspect-[2/1]"}),e.profile_image_url?n.jsx("img",{src:e.profile_image_url,alt:"Profile",className:"rounded-full border-2 bg-white border-white absolute bottom-0 left-1/2 transform translate-y-1/2 -translate-x-1/2 w-[140px] h-[140px] object-cover"}):n.jsx("img",{src:"/assets/images/profile-placeholder.png",alt:"Profile",className:"rounded-full border-2 bg-white border-white absolute bottom-0 left-1/2 transform translate-y-1/2 -translate-x-1/2 w-[140px] h-[140px] object-cover"})]}),n.jsx("div",{children:n.jsxs("div",{className:"mt-20 space-y-2 text-center",children:[n.jsx("h2",{className:"text-xl text-center leading-tight font-black font-public-sans",style:{color:e?.name_text_color||"#000000"},children:e.title||e.first_name||e.last_name?`${e?.title} ${e?.first_name} ${e?.last_name}`:"Dr. John Doe"}),e.degree||e.degree_de?n.jsx("p",{className:"text-sm italic leading-tight font-bold",style:{color:e?.name_text_color||"#000000"},children:i&&e.degree_de?e.degree_de:e.degree}):null,(e.position||e.department||e.company_name)&&n.jsxs("div",{className:"space-y-1",style:{color:e?.company_text_color||"#000000"},children:[(e.position||e.department)&&n.jsxs("p",{className:"text-sm font-medium flex items-center justify-center flex-wrap gap-1.5 text-center",children:[i&&e.position_de||e.position?n.jsx("span",{ref:t,children:i&&e.position_de?e.position_de:e.position}):null,(i&&e.position_de||e.position)&&(i&&e.department_de||e.department)&&r?n.jsx("span",{className:"inline-block h-1 w-1 rounded-full opacity-40",style:{backgroundColor:e?.company_text_color||"#000"}}):null,i&&e.department_de||e.department?n.jsx("span",{ref:a,children:i&&e.department_de?e.department_de:e.department}):null]}),e.company_name&&n.jsx("p",{className:"text-base leading-tight font-bold",dangerouslySetInnerHTML:{__html:e.company_name.replace(/\r?\n/g,"<br>")}})]})]})}),n.jsx(C,{}),n.jsx(z,{cardSocialsLinks:e?.card_social_links??[]}),n.jsx(T,{})]})})}function G(o,l,i={}){if(!o)return{};const e=o?.card_template;return{company_id:e?.company_id??null,name_text_color:e?.name_text_color??"#000000",company_name:e?.company_name??o?.name??"",contact_btn_text:e?.contact_btn_text??"Save contact details",contact_btn_text_de:e?.contact_btn_text_de??"Kontaktdaten speichern",company_text_color:e?.company_text_color??"#000000",card_bg_color:e?.card_bg_color??"#ffffff",btn_bg_color:e?.btn_bg_color??"#87B88C",btn_text_color:e?.btn_text_color??"#ffffff",phone_bg_color:e?.phone_bg_color??"#87B88C",phone_text_color:e?.phone_text_color??"#ffffff",email_bg_color:e?.email_bg_color??"#87B88C",email_text_color:e?.email_text_color??"#ffffff",address_bg_color:e?.address_bg_color??"#87B88C",address_text_color:e?.address_text_color??"#ffffff",website_bg_color:e?.website_bg_color??"#87B88C",website_text_color:e?.website_text_color??"#ffffff",contact_btn_text:e?.contact_btn_text??"Save card",vcard_btn_bg_color:e?.vcard_btn_bg_color??"#87B88C",vcard_btn_text_color:e?.vcard_btn_text_color??"#ffffff",buttons_size:e?.buttons_size??"14",banner_image:null,banner_image_url:e?.banner_image?`/storage/${e.banner_image}`:null,wallet_logo_image:null,wallet_logo_image_url:e?.wallet_logo_image?`/storage/${e.wallet_logo_image}`:null,google_wallet_logo_image:null,google_wallet_logo_image_url:e?.google_wallet_logo_image?`/storage/${e.google_wallet_logo_image}`:null,wallet_label_color:e?.wallet_label_color??"#000000",wallet_text_color:e?.wallet_text_color??"#000000",wallet_bg_color:e?.wallet_bg_color??"#c4f1c8",wallet_label_1:e?.wallet_label_1??"Name",wallet_label_2:e?.wallet_label_2??"Firmenname",wallet_label_3:e?.wallet_label_3??"Titel",wallet_qr_caption:e?.wallet_qr_caption??"QR-Code scannen",wallet_title:e?.wallet_title??"Pass Name",wallet_name:e?.wallet_name??[e?.title?.trim()||"",e?.first_name?.trim()||"John",e?.last_name?.trim()||"Doe"].filter(Boolean).join(" "),wallet_company_name:e?.company_name??"Firmenname",wallet_position:e?.position??"Position",wallet_qr_string:"Hello there!",...l?{code:l.code??"",salutation:l.salutation??"",title:l.title??"",first_name:l.first_name??"",last_name:l.last_name??"",primary_email:l?.primary_email??"",degree:l.degree??"",degree_de:l.degree_de??"",position:l.position??"",position_de:l.position_de??"",department:l.department??"",department_de:l.department_de??"",internal_employee_number:l.internal_employee_number??"",profile_image_url:l?.profile_image?`/storage/${l.profile_image}`:"/assets/images/profile-placeholder.png",profile_image:null,wallet_qr_string:l?.card_wallet?.download_link??"Hello there!",wallet_name:e?.wallet_name??[l?.title?.trim()||"",l?.first_name?.trim()||"John",l?.last_name?.trim()||"Doe"].filter(Boolean).join(" "),wallet_position:l?.position??"Position"}:{},card_social_links:Array.isArray(o?.card_social_links)?o.card_social_links.map(t=>({id:t.id||null,icon:t.icon||"",url:t.url||"",company_id:t.company_id||null,card_id:t.card_id||null})):[],card_phone_numbers:Array.isArray(o?.card_phone_numbers)?o.card_phone_numbers.map(t=>({id:t.id||null,icon:t.icon||"",phone_number:t.phone_number||"",is_hidden:t.is_hidden??!1,type:t.type??"Work",company_id:t.company_id||null,card_id:t.card_id||null,label:t.label||"",label_de:t.label_de||""})):[],card_emails:Array.isArray(o?.card_emails)?o.card_emails.map(t=>({id:t.id||null,email:t.email||"",is_hidden:t.is_hidden??!1,type:t.type??"Work",company_id:t.company_id||null,card_id:t.card_id||null,label:t.label||"",label_de:t.label_de||""})):[],card_addresses:Array.isArray(o?.card_addresses)?o.card_addresses.map(t=>({id:t.id||null,street:t.street||"",house_number:t.house_number||"",zip:t.zip||"",city:t.city||"",country:t.country||"",map_link:t.map_link||"",is_hidden:t.is_hidden??!1,type:t.type??"Work",company_id:t.company_id||null,card_id:t.card_id||null,label:t.label||"",label_de:t.label_de||""})):[],card_buttons:Array.isArray(o?.card_buttons)?o.card_buttons.map(t=>({id:t.id||null,button_text:t.button_text||"",button_text_de:t.button_text_de||"",button_link:t.button_link||"",icon:t.icon||"",company_id:t.company_id||null,card_id:t.card_id||null})):[],card_websites:Array.isArray(o?.card_websites)?o.card_websites.map(t=>({id:t.id||null,url:t.url||"",icon:t.icon||null,is_hidden:t.is_hidden??!1,company_id:t.company_id||null,card_id:t.card_id||null,label:t.label||"",label_de:t.label_de||""})):[]}}export{W as C,G as m};
