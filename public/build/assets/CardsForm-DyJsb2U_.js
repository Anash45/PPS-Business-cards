import{u as q,r as n,j as a,I as r,S as b,T as d,C as g,b as _,E as f,d as w}from"./app-PKz9FedL.js";import{g as F}from"./viteConfig-gEqUb4HH.js";import C from"./CardsPreview-BZ7jn8sd.js";import"./dayjs.min-Cz2NOqpQ.js";import"./CustomDataTable-CWMl17lz.js";import"./chevron-down-Cy6s_dyY.js";function L({previewCards:p,setPreviewCards:m,independentCards:l=!1}){const{companies:i}=q().props,[u,h]=n.useState("https://app.ppsbusinesscards.de"),[x,y]=n.useState(!1),[t,c]=n.useState({company_id:i.length>0?i[0].id:"",quantity:10,title:"",nfc_quantity:50,domain:u}),[o,j]=n.useState({used_cards:0,total_cards_allowed:0,remaining_cards:0,nfc_used:0,total_nfc_cards:0,nfc_remaining:0});n.useEffect(()=>{(async()=>{const e=await F();h(e),c(s=>({...s,domain:e}))})()},[]),n.useEffect(()=>{const e=i.find(s=>s.id===parseInt(t.company_id));e&&j({used_cards:e.used_cards,total_cards_allowed:e.total_cards_allowed,remaining_cards:e.remaining_cards,nfc_used:e.nfc_used,total_nfc_cards:e.total_nfc_cards,nfc_remaining:e.nfc_remaining})},[t.company_id,i]);const v=()=>m([]),N=async e=>{e.preventDefault(),y(!0),m([]);try{const s=l?await _.post("/cards/independent",{title:t.title,nfc_quantity:t.nfc_quantity}):await _.post("/cards",{company_id:t.company_id,quantity:t.quantity,nfc_quantity:t.nfc_quantity});console.log("Cards: ",s.data),s.data.success?(m(s.data.createdNfcCards),f.success("Generated successfully!"),w.reload({only:["cardsGroups","independentGroups","companies"]})):f.error(s.data.message||"Failed to generate cards")}catch(s){console.error(s),f.error(s.response?.data?.message||"Failed to generate cards")}finally{y(!1)}};return a.jsxs(a.Fragment,{children:[a.jsxs("form",{onSubmit:N,className:"grid gap-3 md:grid-cols-2 grid-cols-1",children:[!l&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(r,{htmlFor:"company",value:"Company",className:"text-[#344054] font-medium"}),a.jsx(b,{id:"company",name:"company_id",value:t.company_id,onChange:e=>c({...t,company_id:e.target.value}),className:"w-full block",options:i.map(e=>({value:e.id,label:e.name}))})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[a.jsx(r,{htmlFor:"quantity",value:"Number of employees",className:"text-[#344054] font-medium leading-tight"}),a.jsxs("span",{className:"text-xs font-semibold text-[#344054] leading-tight",children:["(",o.used_cards,"/",o.total_cards_allowed,")"]})]}),a.jsx(d,{id:"quantity",name:"quantity",type:"number",value:t.quantity,onChange:e=>c({...t,quantity:e.target.value}),className:"block w-full",required:!0})]})]}),l&&a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"flex gap-2 flex-wrap items-center",children:a.jsx(r,{htmlFor:"title",value:"Cards title",className:"text-[#344054] font-medium leading-tight"})}),a.jsx(d,{id:"title",name:"title",type:"text",value:t.title,onChange:e=>c({...t,title:e.target.value}),className:"block w-full",required:!0})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[a.jsx(r,{htmlFor:"nfc_quantity",value:"Number of NFC cards",className:"text-[#344054] font-medium leading-tight"}),!l&&a.jsxs("span",{className:"text-xs font-semibold text-[#344054] leading-tight",children:["(",o.nfc_used,"/",o.total_nfc_cards,")"]})]}),a.jsx(d,{id:"nfc_quantity",name:"nfc_quantity",type:"number",value:t.nfc_quantity,onChange:e=>c({...t,nfc_quantity:e.target.value}),className:"block w-full",required:!0})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(r,{htmlFor:"domain",value:"Domain (read-only)",className:"text-[#344054] font-medium"}),a.jsx(d,{id:"domain",name:"domain",value:u,readOnly:!0,className:"block w-full"})]}),a.jsxs("div",{className:"flex-wrap gap-1 items-center md:col-span-2 flex mt-3",children:[a.jsx(g,{type:"submit",disabled:x,children:x?"Generating...":"Generate Cards"}),a.jsx(g,{variant:"light",type:"button",onClick:v,children:"Clear Preview"})]})]}),p.length>0&&a.jsx(C,{independentCards:l,domain:u,previewCards:p})]})}export{L as default};
