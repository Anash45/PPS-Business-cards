import{g as $,j as n,c as p,r as b,n as k,e as y}from"./app-g6ZrvbRL.js";import{g as P}from"./viteConfig-BIBuROsR.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],R=$("smile",C);function A({cardSocialsLinks:r}){return r?.length?n.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-center",children:(r||[]).map((t,a)=>t.url&&n.jsx("a",{href:t.url||"#",target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 hover:text-gray-700 transition",children:t.icon?n.jsx("img",{src:`/assets/images/icons/${t.icon.replace(/^Fa/,"").toLowerCase()}.png`,alt:t.icon,className:"h-7"}):null},a))}):null}function B({cardPhones:r}){const{isCardReal:t,cardFormData:a}=p(),o=r?.filter(i=>!i.is_hidden),e=o&&o.length>0?o:[{label:"Sample",phone_number:"+44 1234 567890",is_hidden:!1}];return n.jsx("div",{className:"grid gap-2 grid-cols-1",children:e.map((i,s)=>n.jsxs("a",{target:"_blank",href:`tel:${i.phone_number}`,style:{color:a?.phone_text_color??a?.btn_text_color,backgroundColor:a?.phone_bg_color??a?.btn_bg_color,borderColor:a?.phone_bg_color??a?.btn_bg_color},className:"flex relative border text-sm leading-tight items-center gap-3 justify-content-start rounded-lg px-4 py-2.5 font-medium preview-btn w-full",children:[n.jsx("span",{className:"shrink-0 text-xl",children:"ðŸ“ž"}),n.jsxs("span",{children:[i.label?n.jsxs("span",{children:[i.label,": "]}):null," ",i.phone_number]}),i.is_hidden&&n.jsx("span",{className:"absolute -translate-y-1/2 translate-x-1 top-0 right-0 text-[10px] rounded bg-orange-500 py-0.5 px-2 italic text-white",children:"(Hidden)"})]},s))})}function D({cardEmails:r}){const{isCardReal:t,cardFormData:a}=p(),o=r?.filter(i=>!i.is_hidden),e=o&&o.length>0?o:[{label:"Sample",email:"sample@email.com",is_hidden:!1}];return n.jsx("div",{className:"grid gap-2 grid-cols-1",children:e.map((i,s)=>n.jsxs("a",{target:"_blank",href:`mailto:${i.email}`,style:{color:a?.email_text_color??a?.btn_text_color,backgroundColor:a?.email_bg_color??a?.btn_bg_color,borderColor:a?.email_bg_color??a?.btn_bg_color},className:"flex border text-sm leading-tight relative items-center gap-3 justify-content-start rounded-lg px-4 py-2.5 font-medium preview-btn",children:[n.jsx("span",{className:"shrink-0 text-xl",children:"âœ‰ï¸"}),n.jsxs("span",{children:[i.label?n.jsxs("span",{children:[i.label,": "]}):null,i.email]}),i.is_hidden?n.jsx("span",{className:"absolute -translate-y-1/2 translate-x-1 top-0 right-0 text-[10px] rounded bg-orange-500 py-0.5 px-2 italic text-white",children:"(Hidden)"}):null]},s))})}function L({cardAddresses:r}){const{isCardReal:t,cardFormData:a}=p(),o=r?.filter(e=>!e.is_hidden);return o?.length>0?n.jsx("div",{className:"grid gap-2 grid-cols-1",children:o.map((e,i)=>e.is_hidden&&t?null:n.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:`https://www.google.de/maps/search/?api=1&query=${encodeURIComponent([e.street,e.house_number,e.zip,e.city,e.country].filter(Boolean).join(" "))}`,style:{color:a?.address_text_color??a?.btn_text_color,backgroundColor:a?.address_bg_color??a?.btn_bg_color,borderColor:a?.address_bg_color??a?.btn_bg_color},className:"flex border text-sm leading-tight relative items-center gap-3 justify-content-start rounded-lg px-4 py-2.5 font-medium preview-btn",children:[n.jsx("span",{className:"shrink-0 text-xl",children:"ðŸ“"}),n.jsx("span",{children:e.label?n.jsx("span",{children:e.label}):n.jsxs("span",{children:[[e.street,e.house_number].filter(Boolean).join(" "),e.street||e.house_number?", ":"",[e.zip,e.city].filter(Boolean).join(" "),e.zip||e.city?", ":"",e.country||""]})}),e.is_hidden?n.jsx("span",{className:"absolute -translate-y-1/2 translate-x-1 top-0 right-0 text-[10px] rounded bg-orange-500 py-0.5 px-2 italic text-white",children:"(Hidden)"}):null]},i))}):null}function F({cardButtons:r}){const{cardFormData:t}=p();return r?.length>0?n.jsx("div",{className:"grid gap-2 grid-cols-1",children:r.map((a,o)=>a.button_text&&n.jsxs("a",{target:"_blank",href:a.button_link,style:{color:t?.btn_text_color,backgroundColor:t?.btn_bg_color,borderColor:t?.btn_bg_color??"#87B88C"},className:"flex border text-sm leading-tight items-center gap-3 justify-content-start rounded-lg px-4 py-2.5 font-medium preview-btn",children:[n.jsx("span",{className:"shrink-0 text-xl",children:a.icon?a.icon:n.jsx(R,{className:"h-7 w-7"})}),n.jsx("span",{children:a.button_text})]},o))}):null}function O(){const{cardFormData:r}=p(),[t,a]=b.useState("https://app.ppsbusinesscards.de");b.useEffect(()=>{(async()=>{const s=await P();a(s)})()},[]);const o=async()=>{if(!r)return;console.log("cardFormData: ",r);const s=r.first_name||"",d=r.last_name||"",m=r.company_name||"";let c=`BEGIN:VCARD
VERSION:3.0
N:${d};${s};;${r.title||""};
FN:${[r.salutation,s,d].filter(Boolean).join(" ")}
ORG:${m}
TITLE:${r.position||""}
ROLE:${r.department||""}
`;if(r.profile_image_url)try{const l=await e(`${t}${r.profile_image_url}`);if(l){const u=i(r.profile_image_url);c+=`PHOTO;ENCODING=b;TYPE=${u}:${l}
`}}catch(l){console.warn("Failed to convert image to base64, falling back to URL:",l),c+=`PHOTO;VALUE=URI:${t}${r.profile_image_url}
`}(r.card_websites||[]).forEach(l=>{l.url&&(l.label?c+=`URL;TYPE=${l.label.toUpperCase()}:${l.url}
`:c+=`URL:${l.url}
`)}),(r.card_phone_numbers||[]).forEach((l,u)=>{if(l.phone_number){const g=(l.type||"Work").toUpperCase();c+=`TEL;TYPE=${u===0?"PREF,":""}${g},VOICE:${l.phone_number}
`}}),(r.card_emails||[]).forEach((l,u)=>{if(l.email){const g=(l.type||"Work").toUpperCase();c+=`EMAIL;TYPE=${u===0?"PREF,":""}${g}:${l.email}
`}}),(r.card_addresses||[]).forEach((l,u)=>{if(l.street||l.house_number||l.city||l.country){const g=(l.type||"Work").toUpperCase(),h=u===0?"PREF,":"",w=[l.street,l.house_number].join(" "),v=l.city||"",N=l.zip||"",E=l.country||"";c+=`ADR;TYPE=${h}${g}:;;${w};${v};;${N};${E}
`}}),c+="END:VCARD";const f=new Blob([c],{type:"text/vcard;charset=utf-8"}),x=URL.createObjectURL(f),_=document.createElement("a"),j=m.replace(/\s+/g,"_");_.download=`${s}_${d}_${j}.vcf`,_.href=x,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(x),k.success("vCard downloaded!");try{const l=await y.post("/cards/increment-downloads",{code:r.code});l.data.success?console.log("Downloads updated:",l.data.downloads):console.warn("Download increment failed:",l.data.message)}catch(l){console.error("Error incrementing downloads:",l)}},e=s=>new Promise((d,m)=>{const c=new Image;c.crossOrigin="Anonymous",c.onload=()=>{const f=document.createElement("canvas"),x=f.getContext("2d");f.width=c.width,f.height=c.height,x.drawImage(c,0,0);try{const _=f.toDataURL("image/jpeg").split(",")[1];d(_)}catch(_){m(_)}},c.onerror=m,c.src=s,c.complete&&c.onload()}),i=s=>{const d=s.split(".").pop()?.toLowerCase()||"jpeg";return{jpg:"JPEG",jpeg:"JPEG",png:"PNG",gif:"GIF",bmp:"BMP",webp:"WEBP"}[d]||"JPEG"};return n.jsx("div",{className:"flex items-center justify-center",children:n.jsx("button",{onClick:o,style:{color:r?.vcard_btn_text_color||r?.btn_text_color||"#ffffff",backgroundColor:r?.vcard_btn_bg_color||r?.btn_bg_color||"#87B88C",borderColor:r?.vcard_btn_bg_color||r?.btn_bg_color||"#87B88C"},className:"px-4 py-2.5 rounded-[10px] text-sm font-medium leading-tight w-fit",children:r.contact_btn_text})})}function S({cardWebsites:r}){const{cardFormData:t}=p(),a=r?.filter(o=>!o.is_hidden);return a?.length?n.jsx("div",{className:"grid gap-2 grid-cols-1",children:a.map((o,e)=>n.jsxs("a",{href:o.url?.startsWith("http")?o.url:`https://${o.url}`,target:"_blank",rel:"noopener noreferrer",style:{color:t?.website_text_color??t?.btn_text_color,backgroundColor:t?.website_bg_color??t?.btn_bg_color,borderColor:t?.website_bg_color??t?.btn_bg_color},className:"flex border text-sm leading-tight relative items-center gap-3 justify-start rounded-lg px-4 py-2.5 font-medium preview-btn",children:[n.jsx("span",{className:"shrink-0 text-xl",children:o.icon?n.jsx("span",{children:o.icon}):n.jsx("span",{children:"ðŸŒ"})}),n.jsx("span",{className:"truncate",children:o.label?n.jsx("span",{children:o.label}):o.url}),o.is_hidden?n.jsx("span",{className:"absolute -translate-y-1/2 translate-x-1 top-0 right-0 text-[10px] rounded bg-orange-500 py-0.5 px-2 italic text-white",children:"(Hidden)"}):null]},e))}):null}function I(){const{cardFormData:r,cardSectionsOrder:t,setCardSectionsOrder:a}=p(),o=["phoneNumbers","emails","websites","addresses","buttons"];b.useEffect(()=>{r?.company_id&&(t&&t.length>0||y.get(`/company/${r.company_id}/card-sections-order`).then(s=>{s.data.order&&Array.isArray(s.data.order)?a(s.data.order):a(o)}).catch(s=>{console.warn("âš ï¸ Failed to fetch card section order:",s),a(o)}))},[r?.company_id]);const e={phoneNumbers:n.jsx(B,{cardPhones:r?.card_phone_numbers??[]},"phoneNumbers"),emails:n.jsx(D,{cardEmails:r?.card_emails??[]},"emails"),websites:n.jsx(S,{cardWebsites:r?.card_websites??[]},"websites"),addresses:n.jsx(L,{cardAddresses:r?.card_addresses??[]},"addresses"),buttons:n.jsx(F,{cardButtons:r?.card_buttons??[]},"buttons")},i=t?.length?t:o;return n.jsx("div",{className:"space-y-2",children:i.map(s=>e[s]??null)})}function W({isReal:r=!1}){const{cardFormData:t}=p(),a=b.useRef(null),o=b.useRef(null),[e,i]=b.useState(!0);return b.useEffect(()=>{const s=()=>{if(a.current&&o.current){const d=a.current.getBoundingClientRect(),m=o.current.getBoundingClientRect();i(Math.abs(d.top-m.top)<5)}};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[t?.position,t?.department]),n.jsx("div",{className:`border ${r?"border-transparent":"border-[#EAECF0]"} rounded-lg p-3 mx-auto w-[430px] max-w-full`,style:{backgroundColor:t?.card_bg_color??"#ffffff"},children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"relative border border-[#EAECF0] bg-gradient bg-gradient-to-b from-[#eaffec] to-transparent rounded-lg w-full h-[200px]",children:[t.banner_image_url?n.jsx("img",{src:t.banner_image_url,alt:"Banner",className:"w-full h-full object-cover rounded-lg"}):null,t.profile_image_url?n.jsx("img",{src:t.profile_image_url,alt:"Profile",className:"rounded-full border-2 bg-white border-white absolute bottom-0 left-1/2 transform translate-y-1/2 -translate-x-1/2 w-[140px] h-[140px] object-cover"}):n.jsx("img",{src:"/assets/images/profile-placeholder.png",alt:"Profile",className:"rounded-full border-2 bg-white border-white absolute bottom-0 left-1/2 transform translate-y-1/2 -translate-x-1/2 w-[140px] h-[140px] object-cover"})]}),n.jsx("div",{children:n.jsxs("div",{className:"mt-20 space-y-2 text-center",children:[n.jsx("h2",{className:"text-xl text-center leading-tight font-black font-public-sans",style:{color:t?.name_text_color||"#000000"},children:t.title||t.first_name||t.last_name?`${t?.title} ${t?.first_name} ${t?.last_name}`:"Mr. John Doe"}),t.degree?n.jsx("p",{className:"text-sm italic leading-tight font-bold",style:{color:t?.name_text_color||"#000000"},children:t.degree}):null,t.position||t.department||t.company_name?n.jsxs("div",{className:"space-y-1",style:{color:t?.company_text_color||"#000000"},children:[t.position||t.department?n.jsxs("p",{className:"text-sm font-medium flex items-center justify-center flex-wrap gap-1.5 text-center",children:[t?.position&&n.jsx("span",{ref:a,children:t.position}),t?.position&&t?.department&&e&&n.jsx("span",{className:"inline-block h-1 w-1 rounded-full opacity-40",style:{backgroundColor:t?.company_text_color||"#000"}}),t?.department&&n.jsx("span",{ref:o,children:t.department})]}):null,t.company_name?n.jsx("p",{className:"text-base leading-tight font-bold",children:t.company_name}):null]}):null]})}),n.jsx(O,{}),n.jsx(A,{cardSocialsLinks:t?.card_social_links??[]}),n.jsx(I,{})]})})}function z(r,t,a={}){if(console.log("Mapping company template data for:",r,t),!r)return{};const o=r?.card_template;return{company_id:o?.company_id??null,name_text_color:o?.name_text_color??"#000000",company_name:o?.company_name??r?.name??"",contact_btn_text:o?.contact_btn_text??"Save contact details",company_text_color:o?.company_text_color??"#000000",card_bg_color:o?.card_bg_color??"#ffffff",btn_bg_color:o?.btn_bg_color??"#87B88C",btn_text_color:o?.btn_text_color??"#ffffff",phone_bg_color:o?.phone_bg_color??"#87B88C",phone_text_color:o?.phone_text_color??"#ffffff",email_bg_color:o?.email_bg_color??"#87B88C",email_text_color:o?.email_text_color??"#ffffff",address_bg_color:o?.address_bg_color??"#87B88C",address_text_color:o?.address_text_color??"#ffffff",website_bg_color:o?.website_bg_color??"#87B88C",website_text_color:o?.website_text_color??"#ffffff",contact_btn_text:o?.contact_btn_text??"Save card",vcard_btn_bg_color:o?.vcard_btn_bg_color??"#87B88C",vcard_btn_text_color:o?.vcard_btn_text_color??"#ffffff",banner_image:null,banner_image_url:o?.banner_image?`/storage/${o.banner_image}`:null,...t?{code:t.code??"",salutation:t.salutation??"",title:t.title??"",first_name:t.first_name??"",last_name:t.last_name??"",degree:t.degree??"",position:t.position??"",department:t.department??"",profile_image_url:t?.profile_image?`/storage/${t.profile_image}`:"/assets/images/profile-placeholder.png",profile_image:null}:{},card_social_links:Array.isArray(r?.card_social_links)?r.card_social_links.map(e=>({id:e.id||null,icon:e.icon||"",url:e.url||"",company_id:e.company_id||null,card_id:e.card_id||null})):[],card_phone_numbers:Array.isArray(r?.card_phone_numbers)?r.card_phone_numbers.map(e=>({id:e.id||null,phone_number:e.phone_number||"",is_hidden:e.is_hidden??!1,type:e.type??"Work",company_id:e.company_id||null,card_id:e.card_id||null,label:e.label||""})):[],card_emails:Array.isArray(r?.card_emails)?r.card_emails.map(e=>({id:e.id||null,email:e.email||"",is_hidden:e.is_hidden??!1,type:e.type??"Work",company_id:e.company_id||null,card_id:e.card_id||null,label:e.label||""})):[],card_addresses:Array.isArray(r?.card_addresses)?r.card_addresses.map(e=>({id:e.id||null,street:e.street||"",house_number:e.house_number||"",zip:e.zip||"",city:e.city||"",country:e.country||"",is_hidden:e.is_hidden??!1,type:e.type??"Work",company_id:e.company_id||null,card_id:e.card_id||null,label:e.label||""})):[],card_buttons:Array.isArray(r?.card_buttons)?r.card_buttons.map(e=>({id:e.id||null,button_text:e.button_text||"",button_link:e.button_link||"",icon:e.icon||"",company_id:e.company_id||null,card_id:e.card_id||null})):[],card_websites:Array.isArray(r?.card_websites)?r.card_websites.map(e=>({id:e.id||null,url:e.url||"",icon:e.icon||null,is_hidden:e.is_hidden??!1,company_id:e.company_id||null,card_id:e.card_id||null,label:e.label||""})):[]}}export{W as C,R as S,z as m};
