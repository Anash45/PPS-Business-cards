import{c as H,j as s,u as z,a as V,r as o,H as G,z as l,b as p,d as u,D as A}from"./app-B8v70Kz_.js";import{A as K}from"./AuthenticatedLayout-D84Nizuv.js";import{E as D,D as Y}from"./dataTables.dataTables-lGqo9zGj.js";import{D as T,a as i}from"./DropdownUi-BYEESAOp.js";import{g as J}from"./viteConfig-gEqUb4HH.js";import{c as Q}from"./csvFieldDefinitions-TqO1r_F2.js";import{W as X,a as Z}from"./WalletEligibilityPill-Ba3K3w0f.js";import{C as ee}from"./chevron-down-BbfG6LnL.js";import{S as se}from"./square-pen-nIa7x4ys.js";import{T as te}from"./trash-2-DBrvMLQ4.js";import"./ApplicationLogo-BnF8xtr0.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],re=H("loader-circle",ae);function le({isSyncing:m}){return m?s.jsxs("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 text-yellow-700 p-4 mb-2 flex items-start gap-3",children:[s.jsx(re,{className:"h-5 w-5 animate-spin flex-shrink-0 mt-1"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-bold",children:"Card Wallets syncing..."}),s.jsx("p",{className:"mt-1 text-sm",children:"⚠️ Keep the page open until it finishes. It may take some time."})]})]}):null}D.use(Y);function xe(){const{cards:m,isSubscriptionActive:$}=z().props,{setHeaderTitle:_,setHeaderText:I}=V(),[f,L]=o.useState("https://app.ppsbusinesscards.de"),P=async e=>{if(window.confirm("This will delete all card details and related data permanently. Are you sure?"))try{const a=await p.put(`/company/cards/${e}/delete`);a.data.success?(l.success(a.data.message),u.reload({only:["cards"]}),typeof refreshTable=="function"&&refreshTable()):l.error(a.data.message||"Failed to delete card.")}catch(a){console.error(a),l.error(a.response?.data?.message||"An error occurred while deleting the card.")}},M=async()=>{if(!c||c.length===0){l.error("Please select at least one employee.");return}if(window.confirm(`This will delete all details for ${c.length} employee(s) permanently. Are you sure?`))try{const e=await p.put("/company/cards/bulk-delete",{ids:c});e.data.success?(l.success(e.data.message),u.reload({only:["cards"]}),typeof refreshTable=="function"&&refreshTable()):l.error(e.data.message||"Failed to delete selected employees.")}catch(e){console.error(e),l.error(e.response?.data?.message||"An error occurred while deleting selected employees.")}};o.useEffect(()=>{(async()=>{const e=await J();L(e),console.log("Cards",m)})()},[]),o.useEffect(()=>{_("Employees Management"),I("")},[]);const R=(e,a,t)=>{const r=document.createElement("div");return setTimeout(()=>{A.createRoot(r).render(s.jsxs(T,{children:[s.jsx(i,{onClick:()=>window.location.href=`/company/cards/${t.id}/edit`,children:s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(se,{className:"h-4 w-4"})," ",s.jsx("span",{children:"Edit"})]})}),s.jsx(i,{onClick:()=>P(t.id),children:s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(te,{className:"h-4 w-4"})," ",s.jsx("span",{children:"Delete"})]})}),s.jsx(i,{onClick:()=>B(t.id,t.status),children:t.status==="active"?"Set Inactive":"Set Active"})]}))},0),r},W=(e,a,t)=>{const r=document.createElement("div");return setTimeout(()=>{A.createRoot(r).render(s.jsxs("div",{className:"flex gap-1 items-center flex-wrap",children:[s.jsx(X,{eligibility:t?.is_eligible_for_sync?.eligible}),s.jsx(Z,{status:t?.wallet_status?.status})]}))},0),r},B=async(e,a)=>{const t=a==="active"?"inactive":"active";if(confirm(`Are you sure you want to set this card as ${t}?`))try{const r=await p.put(`/cards/${e}/toggle-status`,{status:t});r.data?.success?(l.success(r.data.message||"Card status updated successfully."),u.reload({only:["cards"]}),typeof refreshTable=="function"&&refreshTable()):l.error(r.data?.message||"Failed to update card status.")}catch(r){if(r.response&&r.response.data){const n=r.response.data;n.message?l.error(n.message):n.errors?Object.values(n.errors).forEach(d=>{l.error(d)}):l.error("An unexpected error occurred.")}else l.error("Network error or server is unreachable.")}},[b,v]=o.useState(!1),[j,w]=o.useState(!1),[c,g]=o.useState([]),F=o.useMemo(()=>[{title:'<input type="checkbox" id="select-all" /> ID',data:"id",orderable:!1,render:(e,a,t)=>{const r=c.includes(t.id);return`
        <div class="flex items-center gap-2">
            <input type="checkbox" 
                   class="row-checkbox" 
                   value="${t.id}" 
                   ${r?"checked":""} />
            <span>${t.id}</span>
        </div>
    `}},{title:"Code",data:"code",render:(e,a,t)=>`<a href="${f}/card/${e}" target="_blank" class="text-[#50bd5b] underline">${e}</a>`},{title:"User",data:null,render:(e,a,t)=>{const n=[t.salutation,t.title,t.first_name,t.last_name].filter(Boolean).join(" ");return`
                    <div class="flex items-center gap-2">
                        <img
                            src="${t.profile_image?`/storage/${t.profile_image}`:"/assets/images/profile-placeholder.png"}"
                            alt="Profile"
                            class="rounded-full border-2 bg-white border-white w-8 h-8 object-cover shrink-0"
                        />
                        <div class="space-y0.5">
                            <p class="font-medium text-[#181D27] text-sm">
                                ${n||"Not assigned"}
                            </p>
                            ${t.primary_email?`<p class="text-xs">${t.primary_email}</p>`:""}
                        </div>
                    </div>
                `}},{title:"Position",data:"position"},{title:"Department",data:"department"},{title:"Status",data:"status",render:e=>{const a=e==="active";return`<span class="px-2 py-1 text-xs font-medium rounded-full ${a?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"}">
                    ${a?"Active":"Inactive"}
                </span>`}},{title:"Wallet Status",data:null,render:W},{title:"Actions",data:null,orderable:!1,searchable:!1,render:R}],[f]);o.useEffect(()=>{const e=document.getElementById("select-all");if(!e)return;const a=r=>{const n=r.target.checked,d=document.querySelectorAll(".row-checkbox"),h=[];d.forEach(E=>{E.checked=n,n&&h.push(parseInt(E.value))}),g(n?h:[]),w(n)},t=()=>{const r=document.querySelectorAll(".row-checkbox"),n=Array.from(document.querySelectorAll(".row-checkbox:checked")),d=n.map(h=>parseInt(h.value));e.checked=n.length===r.length,g(d),w(d.length>0)};return e.addEventListener("change",a),document.addEventListener("change",r=>{r.target.classList.contains("row-checkbox")&&t()}),()=>{e.removeEventListener("change",a)}},[f]);const[O,k]=o.useState(!1),U=async()=>{if(!(!m?.length||!c?.length)){k(!0);try{const e=await p.post("/cards/download",{selected_ids:c,csv_fields:Q.map(n=>n.name)},{responseType:"blob"}),a=new Blob([e.data],{type:"text/csv;charset=utf-8;"}),t=window.URL.createObjectURL(a),r=document.createElement("a");r.href=t,r.download="base_sample.csv",r.click(),window.URL.revokeObjectURL(t)}catch(e){console.error("CSV download failed:",e)}finally{k(!1)}}},[x,S]=o.useState(!1),C=async e=>{if(!c.length){l.warning("Please select at least one card.");return}S(!0);try{const a=await p.post("/cards/toggle-multiple-status",{ids:c,status:e});l.success(a.data.message),u.reload({only:["cards"]}),typeof refreshTable=="function"&&refreshTable()}catch(a){console.error("Toggle failed:",a);const t=a.response?.data?.message||"Failed to update status.";l.error(t)}finally{S(!1)}},[y,N]=o.useState([]),q=async()=>{if(!c.length){l.warning("Please select at least one card.");return}v(!0),N([]);try{const e=await p.post("/company/cards/sync-multiple-wallets",{ids:c});l.success(e.data.message||"Cards synced successfully!"),u.reload({only:["cards"]}),g([]),typeof refreshTable=="function"&&refreshTable()}catch(e){if(console.error("Sync failed:",e),e.response?.status===422&&e.response.data.errors)N(e.response.data.errors);else{const a=e.response?.data?.message||"Failed to update wallet.";l.error(a)}}finally{v(!1)}};return console.log("backendErrors: ",y),s.jsxs(K,{children:[s.jsx(G,{title:"Cards"}),s.jsx("div",{className:"py-4 md:px-6 px-4 flex flex-col gap-6",children:$?s.jsx("div",{className:"space-y-5",children:s.jsxs("div",{className:"py-4 md:px-6 px-4 rounded-[14px] bg-white flex flex-col gap-3 space-y-3",children:[s.jsxs("div",{className:"relative mb-2",children:[s.jsx("div",{className:"flex items-center gap-3 flex-wrap",children:s.jsxs(T,{align:"left",button:s.jsxs("div",{className:"flex items-center py-[9px] gap-2 cursor-pointer px-4 rounded-md border border-gray-500 text-sm",children:[s.jsx("span",{children:"Bulk actions"}),s.jsx(ee,{className:"h-5 w-5"})]}),children:[s.jsx(i,{onClick:()=>C("active"),disabled:!c.length||x,children:"Set Active"}),s.jsx(i,{onClick:()=>C("inactive"),disabled:!c.length||x,children:"Set Inactive"}),s.jsx(i,{onClick:()=>M(),disabled:!c.length||x,children:"Delete Multiple"}),s.jsx(i,{onClick:U,disabled:!j,children:O?"Saving...":"Download Base CSV"}),s.jsx(i,{onClick:q,closeOnClick:!0,disabled:!j,children:b?"Syncing...":"Sync wallet"})]})}),c.length>0?s.jsxs("p",{className:"text-sm text-primary top-full left-0 absolute mt-1",children:[c.length," card(s) selected"]}):null]}),Object.keys(y).length>0&&s.jsxs("div",{className:"bg-red-50 border-l-4 border-red-400 text-red-700 p-4 mb-2",children:[s.jsx("p",{className:"font-bold",children:"Some cards could not be synced, fix the issues first then try again."}),s.jsx("ul",{className:"mt-2 list-disc list-inside text-sm",children:Object.entries(y).map(([e,a])=>a.map((t,r)=>s.jsxs("li",{children:["Card #",e,":"," ",t.message]},`${e}-${r}`)))})]}),s.jsx(le,{isSyncing:b}),s.jsx(D,{data:m,columns:F,className:"display site-datatable",options:{responsive:!0,pageLength:10,lengthMenu:[10,25,50,100],dom:"<'flex justify-between items-center mb-3 sd-top'<'flex items-center gap-2'l><'flex items-center gap-2'f>>rt<'flex justify-center mt-3 sd-bottom'p>"}},f)]})}):s.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-md",children:"You can only access this page with a valid subscription. Contact Admin for more information."})})]})}export{xe as default};
