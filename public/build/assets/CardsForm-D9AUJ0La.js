import{u as N,r as n,j as a,I as r,S as v,T as u,C as y,E as b,b as q,F as f,d as w}from"./app-DEF2aXSM.js";import{g as C}from"./viteConfig-BIBuROsR.js";import F from"./CardsPreview-BGMuUaBW.js";import"./dayjs.min-Cwxf7dBf.js";function E({previewCards:i,setPreviewCards:o}){const{companies:c}=N().props,[m,g]=n.useState("https://app.ppsbusinesscards.de"),[p,x]=n.useState(!1),[t,l]=n.useState({company_id:c.length>0?c[0].id:"",quantity:10,nfc_quantity:50,domain:m}),[d,_]=n.useState({used_cards:0,total_cards_allowed:0,remaining_cards:0,nfc_used:0,total_nfc_cards:0,nfc_remaining:0});n.useEffect(()=>{(async()=>{const e=await C();g(e),l(s=>({...s,domain:e}))})()},[]),n.useEffect(()=>{const e=c.find(s=>s.id===parseInt(t.company_id));e&&_({used_cards:e.used_cards,total_cards_allowed:e.total_cards_allowed,remaining_cards:e.remaining_cards,nfc_used:e.nfc_used,total_nfc_cards:e.total_nfc_cards,nfc_remaining:e.nfc_remaining})},[t.company_id,c]);const h=()=>o([]),j=async e=>{e.preventDefault(),x(!0),o([]);try{const s=await q.post("/cards",{company_id:t.company_id,quantity:t.quantity,nfc_quantity:t.nfc_quantity});console.log("Cards: ",s.data),s.data.success?(o(s.data.createdNfcCards),f.success(`${s.data.cards_created} cards generated successfully!`),w.reload({only:["cardsGroups","companies"]})):f.error(s.data.message||"Failed to generate cards")}catch(s){console.error(s),f.error(s.response?.data?.message||"Failed to generate cards")}finally{x(!1)}};return a.jsxs(a.Fragment,{children:[a.jsxs("form",{onSubmit:j,className:"grid gap-3 md:grid-cols-2 grid-cols-1",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx(r,{htmlFor:"company",value:"Company",className:"text-[#344054] font-medium"}),a.jsx(v,{id:"company",name:"company_id",value:t.company_id,onChange:e=>l({...t,company_id:e.target.value}),className:"w-full block",options:c.map(e=>({value:e.id,label:e.name}))})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[a.jsx(r,{htmlFor:"quantity",value:"Number of employees",className:"text-[#344054] font-medium leading-tight"}),a.jsxs("span",{className:"text-xs font-semibold text-[#344054] leading-tight",children:["(",d.used_cards,"/",d.total_cards_allowed,")"]})]}),a.jsx(u,{id:"quantity",name:"quantity",type:"number",value:t.quantity,onChange:e=>l({...t,quantity:e.target.value}),className:"block w-full",required:!0})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[a.jsx(r,{htmlFor:"nfc_quantity",value:"Number of NFC cards",className:"text-[#344054] font-medium leading-tight"}),a.jsxs("span",{className:"text-xs font-semibold text-[#344054] leading-tight",children:["(",d.nfc_used,"/",d.total_nfc_cards,")"]})]}),a.jsx(u,{id:"nfc_quantity",name:"nfc_quantity",type:"number",value:t.nfc_quantity,onChange:e=>l({...t,nfc_quantity:e.target.value}),className:"block w-full",required:!0})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(r,{htmlFor:"domain",value:"Domain (read-only)",className:"text-[#344054] font-medium"}),a.jsx(u,{id:"domain",name:"domain",value:m,readOnly:!0,className:"block w-full"})]}),a.jsxs("div",{className:"flex-wrap gap-1 items-center md:col-span-2 flex mt-3",children:[a.jsx(y,{type:"submit",disabled:p,children:p?"Generating...":"Generate Cards"}),a.jsx(y,{variant:"light",type:"button",onClick:h,children:"Clear Preview"})]})]}),i.length>0&&a.jsxs("div",{className:"flex flex-col gap-3 py-3",children:[a.jsxs("p",{className:"text-[#079E04] text-xs font-medium",children:[i.length," URLs generated."]}),a.jsx("p",{className:"text-xs leading-5 font-medium text-[#475569]",children:"Once generated, the URLs are immediately active. The CSV is automatically downloaded and stored in the History."}),a.jsx(b,{className:"mt-3"})]}),i.length>0&&a.jsx(F,{domain:m,previewCards:i})]})}export{E as default};
