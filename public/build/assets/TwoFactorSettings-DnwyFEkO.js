import{u as x,r as u,A as S,j as e,C as n,I as _,T as C,B as T,S as k,b as o,z as t,d as c}from"./app-lsU9ifOx.js";function I({className:b=""}){const i=x().props.auth.user,[p,d]=u.useState(x().props.totp_qr||null),[s,r]=u.useState(!1),[h,f]=u.useState(null),{data:y,setData:g,errors:j,setError:m,reset:v}=S({code:""});console.log(i);const w=async()=>{r(!0);try{await o.post("/two-factor/email/enable"),t.success("Email 2FA enabled."),c.reload({only:["auth"]})}catch(a){console.error(a),t.error("Failed to enable Email 2FA.")}finally{r(!1)}},A=async()=>{r(!0);try{await o.post("/two-factor/email/disable"),t.success("Email 2FA disabled."),c.reload({only:["auth"]})}catch(a){console.error(a),t.error("Failed to disable Email 2FA.")}finally{r(!1)}},N=async()=>{r(!0);try{const a=await o.post("/two-factor/totp/start");d(a.data.totp_qr),t.success(a.data.message),f(a.data.secret)}catch(a){console.error(a),t.error("Failed to start TOTP setup.")}finally{r(!1)}},F=async()=>{r(!0);try{await o.post("/two-factor/totp/disable"),d(null),t.success("Authenticator App 2FA disabled."),c.reload({only:["auth"]})}catch(a){console.error(a),t.error("Failed to disable TOTP.")}finally{r(!1)}},E=async a=>{a.preventDefault(),r(!0),m("code",null);try{const l=await o.post("/two-factor/totp/verify",{code:y.code});t.success(l.data.message),d(null),v("code"),c.reload({only:["auth"]})}catch(l){l.response?.data?.message?(m("code",l.response.data.message),t.error(l.response.data.message)):(m("code","Something went wrong."),t.error("Something went wrong."))}finally{r(!1)}};return e.jsxs("section",{className:b,children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Two-Factor Authentication"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Improve your account security by enabling 2FA."})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"border p-4 rounded-md",children:[e.jsx("h3",{className:"font-semibold",children:"Email Authentication"}),e.jsx("p",{className:"text-sm text-gray-600",children:"A 6-digit code will be emailed to you at login."}),i.is_email_2fa_enabled?e.jsx(n,{variant:"danger",className:"mt-3",onClick:A,disabled:s,children:s?"Processing...":"Disable Email 2FA"}):e.jsx(n,{className:"mt-3",onClick:w,disabled:s,children:s?"Processing...":"Enable Email 2FA"})]}),e.jsxs("div",{className:"border p-4 rounded-md",children:[e.jsx("h3",{className:"font-semibold",children:"Authenticator App"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use Google Authenticator or Microsoft Authenticator."}),i.is_totp_2fa_enabled?e.jsx(n,{variant:"danger",className:"mt-3",onClick:F,disabled:s,children:s?"Processing...":"Disable Authenticator App"}):e.jsx(n,{className:"mt-3",onClick:N,disabled:s,children:s?"Generating QR...":"Enable Authenticator App"}),p&&e.jsxs("div",{className:"mt-4",children:[e.jsx("img",{src:p,alt:"QR Code",className:"w-48 h-48"}),h&&e.jsxs("p",{className:"mt-2 text-sm text-gray-700",children:["Or enter this key manually in your authenticator app: ",e.jsx("br",{}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:h})]}),e.jsxs("form",{onSubmit:E,className:"mt-4",children:[e.jsx(_,{value:"Enter code from your app"}),e.jsx(C,{value:y.code,onChange:a=>g("code",a.target.value),className:"mt-2 block w-full"}),e.jsx(T,{message:j.code}),e.jsx(n,{className:"mt-3",disabled:s,children:s?"Verifying...":"Verify"})]})]})]}),e.jsxs("div",{className:"border p-4 rounded-md",children:[e.jsx("h3",{className:"font-semibold",children:"When should we ask for 2FA again?"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Choose how frequently you want to re-confirm your identity on this device."}),e.jsx(k,{value:i.two_factor_prompt_interval||"",onChange:async a=>{if(s)return;const l=a.target?a.target.value:a;r(!0);try{await o.post("/two-factor/interval",{interval:l}),t.success("2FA interval updated."),c.reload({only:["auth"]})}catch{t.error("Failed to update interval.")}finally{r(!1)}},menuPlacement:"top",disabled:s,className:"w-full block",placeholder:"Select interval",options:[{value:"",label:"Select interval"},{value:"daily",label:"Once per Day"},{value:"weekly",label:"Once per Week"},{value:"15_days",label:"Once per 15 Days"}]})]})]})]})}export{I as default};
