import{b as P,c as U,r as i,j as n,H,B as f,d as M,e as j,z as d,f as C}from"./app-CD9OQs84.js";import{A as q}from"./AuthenticatedLayout-GzTXpuGb.js";import{E as S,D as F}from"./dataTables.dataTables-DCNon6Yd.js";import{D as O,a as w}from"./DropdownUi-BWTbnVqa.js";import{g as z}from"./viteConfig-BIBuROsR.js";import{c as V}from"./csvFieldDefinitions-_yPXnvkW.js";import"./ApplicationLogo-feXH0ndP.js";S.use(F);function ee(){const{cards:p,isSubscriptionActive:A}=P().props,{setHeaderTitle:E,setHeaderText:$}=U(),[m,D]=i.useState("https://app.ppsbusinesscards.de");i.useEffect(()=>{(async()=>{const t=await z();D(t),console.log("asdsad",t)})()},[]),i.useEffect(()=>{E("Cards Management"),$("")},[]);const I=(t,a,e)=>{const s=document.createElement("div");return setTimeout(()=>{M.createRoot(s).render(n.jsxs(O,{children:[n.jsx(w,{onClick:()=>window.location.href=`/company/cards/${e.id}/edit`,children:"Edit"}),n.jsx(w,{onClick:()=>L(e.id,e.status),children:e.status==="active"?"Set Inactive":"Set Active"})]}))},0),s},L=async(t,a)=>{const e=a==="active"?"inactive":"active";if(confirm(`Are you sure you want to set this card as ${e}?`))try{const s=await j.put(`/cards/${t}/toggle-status`,{status:e});s.data?.success?(d.success(s.data.message||"Card status updated successfully."),C.reload({only:["cards"]})):d.error(s.data?.message||"Failed to update card status.")}catch(s){if(s.response&&s.response.data){const r=s.response.data;r.message?d.error(r.message):r.errors?Object.values(r.errors).forEach(l=>{d.error(l)}):d.error("An unexpected error occurred.")}else d.error("Network error or server is unreachable.")}},[N,h]=i.useState(!1),[c,g]=i.useState([]),T=i.useMemo(()=>[{title:'<input type="checkbox" id="select-all" /> ID',data:"id",orderable:!1,render:(t,a,e)=>{const s=c.includes(e.id);return`
        <div class="flex items-center gap-2">
            <input type="checkbox" 
                   class="row-checkbox" 
                   value="${e.id}" 
                   ${s?"checked":""} />
            <span>${e.id}</span>
        </div>
    `}},{title:"Code",data:"code",render:(t,a,e)=>`<a href="${m}/card/${t}" target="_blank" class="text-[#50bd5b] underline">${t}</a>`},{title:"User",data:null,render:(t,a,e)=>{const r=[e.salutation,e.title,e.first_name,e.last_name].filter(Boolean).join(" ");return`
                    <div class="flex items-center gap-2">
                        <img
                            src="${e.profile_image?`/storage/${e.profile_image}`:"/assets/images/profile-placeholder.png"}"
                            alt="Profile"
                            class="rounded-full border-2 bg-white border-white w-8 h-8 object-cover shrink-0"
                        />
                        <div>
                            <p class="font-medium text-[#181D27] text-sm">
                                ${r||"Not assigned"}
                            </p>
                        </div>
                    </div>
                `}},{title:"Position",data:"position"},{title:"Department",data:"department"},{title:"Status",data:"status",render:t=>{const a=t==="active";return`<span class="px-2 py-1 text-xs font-medium rounded-full ${a?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"}">
                    ${a?"Active":"Inactive"}
                </span>`}},{title:"Actions",data:null,orderable:!1,searchable:!1,render:I}],[m]);i.useEffect(()=>{const t=document.getElementById("select-all");if(!t)return;const a=s=>{const r=s.target.checked,l=document.querySelectorAll(".row-checkbox"),u=[];l.forEach(o=>{o.checked=r,r&&u.push(parseInt(o.value))}),g(r?u:[]),h(r)},e=()=>{const s=document.querySelectorAll(".row-checkbox"),r=Array.from(document.querySelectorAll(".row-checkbox:checked")),l=r.map(u=>parseInt(u.value));t.checked=r.length===s.length,g(l),h(l.length>0)};return t.addEventListener("change",a),document.addEventListener("change",s=>{s.target.classList.contains("row-checkbox")&&e()}),()=>{t.removeEventListener("change",a)}},[m]);const[B,x]=i.useState(!1),R=async()=>{if(!(!p?.length||!c?.length)){console.log(p,c),x(!0);try{const t=V.map(o=>o.name),e=p.filter(o=>c.includes(o.id)).map(o=>t.map((G,_)=>_===0&&o.code||"")),s=[t.join(","),...e.map(o=>o.map(k=>`"${k}"`).join(","))].join(`
`),r=new Blob([s],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(r),u=document.createElement("a");u.href=l,u.download="base_sample.csv",u.click(),URL.revokeObjectURL(l)}catch(t){console.error("CSV generation failed:",t)}finally{x(!1)}}},[b,v]=i.useState(!1),y=async t=>{if(!c.length){d.warning("Please select at least one card.");return}v(!0);try{const a=await j.post("/cards/toggle-multiple-status",{ids:c,status:t});d.success(a.data.message),C.reload({only:["cards"]}),typeof refreshTable=="function"&&refreshTable()}catch(a){console.error("Toggle failed:",a);const e=a.response?.data?.message||"Failed to update status.";d.error(e)}finally{v(!1)}};return n.jsxs(q,{children:[n.jsx(H,{title:"Cards"}),n.jsx("div",{className:"py-4 md:px-6 px-4 flex flex-col gap-6",children:A?n.jsx("div",{className:"space-y-5",children:n.jsxs("div",{className:"py-4 md:px-6 px-4 rounded-[14px] bg-white flex flex-col gap-3 space-y-3",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[n.jsx(f,{onClick:()=>y("active"),disabled:!c.length||b,variant:"primary-outline",children:"Set Active"}),n.jsx(f,{onClick:()=>y("inactive"),disabled:!c.length||b,variant:"danger-outline",children:"Set Inactive"}),n.jsx(f,{onClick:R,variant:"light",disabled:!N,children:B?"Saving...":"Download Base CSV"})]}),c.length>0?n.jsxs("p",{className:"text-sm text-primary",children:[c.length," cards selected"]}):null]}),n.jsx(S,{data:p,columns:T,className:"display site-datatable",options:{responsive:!0,pageLength:10,lengthMenu:[10,25,50,100],dom:"<'flex justify-between items-center mb-3 sd-top'<'flex items-center gap-2'l><'flex items-center gap-2'f>>rt<'flex justify-center mt-3 sd-bottom'p>"}},m)]})}):n.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-md",children:"You can only access this page with a valid subscription. Contact Admin for more information."})})]})}export{ee as default};
