import{u as B,a as q,r as l,j as t,H,S as M,D as R,b as x,z as c,d as b}from"./app-BiiKFIU8.js";import{A as z}from"./AuthenticatedLayout-mAPw1RZn.js";import{E as N,D as U}from"./dataTables.dataTables-rUi0_AmF.js";import{D as k,a as p}from"./DropdownUi-D2ek-PJ4.js";import{g as G}from"./viteConfig-gEqUb4HH.js";import{C as O}from"./chevron-down-DvBB0HC2.js";import"./ApplicationLogo-D46p7oAA.js";N.use(U);function se(){const{nfcCards:y,employeeCards:A,isSubscriptionActive:S}=B().props,{setHeaderTitle:E,setHeaderText:T}=q(),[g,I]=l.useState("https://app.ppsbusinesscards.de");l.useEffect(()=>{(async()=>{const e=await G();I(e)})()},[]),l.useEffect(()=>{E("NFC-Card management"),T("")},[]);const $=(e,r,a)=>{const s=document.createElement("div");return setTimeout(()=>{R.createRoot(s).render(t.jsx(k,{children:t.jsx(p,{onClick:()=>_(a.id,a.status),children:a.status==="active"?"Set Inactive":"Set Active"})}))},0),s};console.log("nfcCards: ",y);const _=async(e,r)=>{const a=r==="active"?"inactive":"active";if(confirm(`Are you sure you want to set this card as ${a}?`))try{const s=await x.put(`/nfc-cards/${e}/toggle-status`,{status:a});s.data?.success?(c.success(s.data.message||"Card status updated successfully."),b.reload({only:["nfcCards"]}),d([])):c.error(s.data?.message||"Failed to update card status.")}catch(s){if(s.response&&s.response.data){const o=s.response.data;o.message?c.error(o.message):o.errors?Object.values(o.errors).forEach(i=>{c.error(i)}):c.error("An unexpected error occurred.")}else c.error("Network error or server is unreachable.")}},[Y,v]=l.useState(!1),[n,d]=l.useState([]),[u,D]=l.useState(null),F=l.useMemo(()=>[{title:'<input type="checkbox" id="select-all" /> ID',data:"id",orderable:!1,render:(e,r,a)=>{const s=n.includes(a.id);return`
        <div class="flex items-center gap-2">
            <input type="checkbox" 
                   class="row-checkbox" 
                   value="${a.id}" 
                   ${s?"checked":""} />
            <span>${a.id}</span>
        </div>
    `}},{title:"Code",data:"qr_code",render:(e,r,a)=>`<a href="${g}/card/${a.qr_code}" target="_blank" class="text-[#50bd5b] underline">${e}</a>`},{title:"Employee",data:null,render:(e,r,a)=>{const s=a.card;if(!s)return'<p class="text-sm text-gray-400">Not assigned</p>';const i=[s.salutation,s.title,s.first_name,s.last_name].filter(Boolean).join(" ");return`
        <div class="flex items-center gap-2">
            <img
                src="${s.profile_image?`/storage/${s.profile_image}`:"/assets/images/profile-placeholder.png"}"
                alt="Profile"
                class="rounded-full border-2 bg-white border-white w-8 h-8 object-cover shrink-0"
            />
            <div>
                <p class="font-medium text-[#181D27] text-sm">
                    ${i||"Not assigned"}
                </p>
            </div>
        </div>
        `}},{title:"Status",data:"status",render:e=>{const r=e==="active";return`<span class="px-2 py-1 text-xs font-medium rounded-full ${r?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"}">
                    ${r?"Active":"Inactive"}
                </span>`}},{title:"Actions",data:null,orderable:!1,searchable:!1,render:$}],[g]);l.useEffect(()=>{const e=document.getElementById("select-all");if(!e)return;const r=s=>{const o=s.target.checked,i=document.querySelectorAll(".row-checkbox"),m=[];i.forEach(j=>{j.checked=o,o&&m.push(parseInt(j.value))}),d(o?m:[]),v(o)},a=()=>{const s=document.querySelectorAll(".row-checkbox"),o=Array.from(document.querySelectorAll(".row-checkbox:checked")),i=o.map(m=>parseInt(m.value));e.checked=o.length===s.length,d(i),v(i.length>0)};return e.addEventListener("change",r),document.addEventListener("change",s=>{s.target.classList.contains("row-checkbox")&&a()}),()=>{e.removeEventListener("change",r)}},[g]);const[f,C]=l.useState(!1),[J,h]=l.useState(!1),w=async e=>{if(!n.length){c.warning("Please select at least one card.");return}console.log("selectedIds: ",n),C(!0);try{const r=await x.post("/nfc-cards/toggle-multiple-status",{ids:n,status:e});c.success(r.data.message),b.reload({only:["nfcCards"]}),d([]),typeof refreshTable=="function"&&refreshTable()}catch(r){console.error("Toggle failed:",r);const a=r.response?.data?.message||"Failed to update status.";c.error(a)}finally{C(!1)}},P=async()=>{if(!n.length){c.warning("Please select at least one NFC card.");return}if(!u){c.warning("Please select an employee.");return}h(!0);try{const e=await x.post(route("nfc-cards.assign"),{ids:n,employee:u});c.success(e.data.message),b.reload({only:["nfcCards","employeeCards"]}),d([]),typeof refreshTable=="function"&&refreshTable()}catch(e){console.error("Assign failed:",e),c.error(e.response?.data?.message||"Failed to assign NFC cards.")}finally{h(!1)}},L=async()=>{if(!n.length){c.warning("Please select at least one NFC card.");return}h(!0);try{const e=await x.post(route("nfc-cards.unassign"),{ids:n});c.success(e.data.message),b.reload({only:["nfcCards","employeeCards"]}),d([]),typeof refreshTable=="function"&&refreshTable()}catch(e){console.error("Unassign failed:",e),c.error(e.response?.data?.message||"Failed to unassign NFC cards.")}finally{h(!1)}};return console.log("Emp: ",u),t.jsxs(z,{children:[t.jsx(H,{title:"NFC-Card management"}),t.jsx("div",{className:"py-4 md:px-6 px-4 flex flex-col gap-6",children:S?t.jsx("div",{className:"space-y-5",children:t.jsxs("div",{className:"py-4 md:px-6 px-4 rounded-[14px] bg-white flex flex-col gap-3 space-y-3",children:[t.jsxs("div",{className:"relative mb-2",children:[t.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[t.jsxs(k,{align:"left",button:t.jsxs("div",{className:"flex items-center py-[9px] gap-2 cursor-pointer px-4 rounded-md border border-gray-500 text-sm",children:[t.jsx("span",{children:"Bulk actions"}),t.jsx(O,{className:"h-5 w-5"})]}),children:[t.jsx(p,{onClick:()=>w("active"),disabled:!n.length||f,children:"Set Active"}),t.jsx(p,{onClick:()=>w("inactive"),disabled:!n.length||f,children:"Set Inactive"}),t.jsx(p,{onClick:()=>{if(!n.length||f||!u)return;window.confirm("Are you sure you want to assign these cards? This action cannot be undone.")&&P()},disabled:!n.length||f||!u,children:"Assign Card(s)"}),t.jsx(p,{onClick:()=>{if(!n.length||f)return;window.confirm("Are you sure you want to unassign these cards? This action cannot be undone.")&&L()},disabled:!n.length||f,children:"Unassign Card(s)"})]}),t.jsx("div",{className:"w-[280px] max-w-full",children:t.jsx(M,{id:"employee",isSearchable:!0,placeholder:"Select or search employee...",name:"employee",value:u,onChange:e=>{D(e.target.value)},className:"w-full block",options:A.map(e=>({value:e.id,label:(()=>{const r=e.id,a=e.internal_employee_number,s=[e.first_name,e.last_name].filter(Boolean).join(" ");if(!a&&!s)return"Not assigned";const o=[a,s].filter(Boolean).join(" - ");return`${r} - (${o})`})(),icon:()=>t.jsx("img",{src:e.profile_image?`/storage/${e.profile_image}`:"/assets/images/profile-placeholder.png",alt:e.first_name||"Employee",className:"h-6 w-6 rounded-full"})}))})})]}),n.length>0?t.jsxs("p",{className:"text-sm text-primary top-full left-0 absolute mt-1",children:[n.length," card(s) selected"]}):null]}),t.jsx(N,{data:y,columns:F,className:"display site-datatable",options:{responsive:!0,pageLength:10,lengthMenu:[10,25,50,100],dom:"<'flex justify-between items-center mb-3 sd-top'<'flex items-center gap-2'l><'flex items-center gap-2'f>>rt<'flex justify-center mt-3 sd-bottom'p>"}},g)]})}):t.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-md",children:"You can only access this page with a valid subscription. Contact Admin for more information."})})]})}export{se as default};
