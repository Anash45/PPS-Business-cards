import{u as _,a as M,r as c,F as $,j as s,H,C as B,S as O,b as g,z as o,d as h}from"./app-PKz9FedL.js";import{A as z}from"./AuthenticatedLayout-C-E0WFy8.js";import{C as L}from"./CustomDataTable-CWMl17lz.js";import{D as j,a as p}from"./DropdownUi-DykeGjy_.js";import{g as R}from"./viteConfig-gEqUb4HH.js";import{C as U}from"./chevron-down-Cy6s_dyY.js";import"./ApplicationLogo-B4j1u-Xs.js";function Z(){const{nfcCards:m,isSubscriptionActive:N}=_().props,{setHeaderTitle:v,setHeaderText:w}=M();console.log("NFC Cards: ",m);const[b,k]=c.useState("https://app.ppsbusinesscards.de");c.useEffect(()=>{(async()=>{const e=await R();k(e)})()},[]),c.useEffect(()=>{v("NFC-Card management"),w("")},[]);const{openModal:S}=$(),A=async(e,a)=>{const t=a==="active"?"inactive":"active";if(confirm(`Are you sure you want to set this card as ${t}?`))try{const n=await g.put(`/nfc-cards/${e}/toggle-status`,{status:t});n.data?.success?(o.success(n.data.message||"Card status updated successfully."),h.reload({only:["nfcCards"]}),l([])):o.error(n.data?.message||"Failed to update card status.")}catch(n){if(n.response&&n.response.data){const u=n.response.data;u.message?o.error(u.message):u.errors?Object.values(u.errors).forEach(x=>{o.error(x)}):o.error("An unexpected error occurred.")}else o.error("Network error or server is unreachable.")}},[r,l]=c.useState([]),[i,T]=c.useState(null),F=e=>{if(e.stopPropagation(),e.target.checked){const t=m.data.map(n=>n.id);l(t)}else l([])},P=(e,a)=>{e.stopPropagation(),l(t=>t.includes(a)?t.filter(n=>n!==a):[...t,a])},I=c.useMemo(()=>[{key:"id",label:s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:r.length>0&&r.length===m.data?.length,onChange:F,onClick:e=>e.stopPropagation(),className:"rounded border-gray-300"}),s.jsx("span",{children:"ID"})]}),sortable:!0,render:(e,a)=>{const t=r.includes(a.id);return s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",className:"row-checkbox rounded border-gray-300",value:a.id,checked:t,onChange:n=>P(n,a.id)}),s.jsx("span",{className:"text-sm text-gray-700",children:a.id})]})}},{key:"qr_code",label:"Code",sortable:!0,render:(e,a)=>s.jsx("a",{href:`${b}/card/${e}`,target:"_blank",rel:"noopener noreferrer",className:"text-[#50bd5b] underline hover:text-[#3da047]",children:e})},{key:"employee",label:"Employee",sortable:!1,render:(e,a)=>{const t=a?.card||null;if(!t)return s.jsx("p",{className:"text-sm text-gray-400",children:"Not assigned"});const u=[t.salutation,t.title,t.first_name,t.last_name].filter(Boolean).join(" "),x=t.profile_image?`/storage/${t.profile_image}`:"/assets/images/profile-placeholder.png";return s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("img",{src:x,alt:"Profile",className:"rounded-full border-2 bg-white border-white w-8 h-8 object-cover shrink-0"}),s.jsx("div",{children:s.jsx("p",{className:"font-medium text-[#181D27] text-sm",children:u||"Not assigned"})})]})}},{key:"status",label:"Status",sortable:!0,render:(e,a)=>{const t=e==="active",n=t?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200";return s.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${n}`,children:t?"Active":"Inactive"})}},{key:"actions",label:"Actions",sortable:!1,render:(e,a)=>s.jsx(j,{children:s.jsx(p,{onClick:()=>A(a.id,a.status),children:a.status==="active"?"Set Inactive":"Set Active"})})}],[b,r,m]),[d,y]=c.useState(!1),[q,f]=c.useState(!1),C=async e=>{if(!r.length){o.warning("Please select at least one card.");return}console.log("selectedIds: ",r),y(!0);try{const a=await g.post("/nfc-cards/toggle-multiple-status",{ids:r,status:e});o.success(a.data.message),h.reload({only:["nfcCards"]}),l([]),typeof refreshTable=="function"&&refreshTable()}catch(a){console.error("Toggle failed:",a);const t=a.response?.data?.message||"Failed to update status.";o.error(t)}finally{y(!1)}},D=async()=>{if(!r.length){o.warning("Please select at least one NFC card.");return}if(!i){o.warning("Please select an employee.");return}f(!0);try{const e=await g.post(route("nfc-cards.assign"),{ids:r,employee:i});o.success(e.data.message),h.reload({only:["nfcCards","employeeCards"]}),l([]),typeof refreshTable=="function"&&refreshTable()}catch(e){console.error("Assign failed:",e),o.error(e.response?.data?.message||"Failed to assign NFC cards.")}finally{f(!1)}},E=async()=>{if(!r.length){o.warning("Please select at least one NFC card.");return}f(!0);try{const e=await g.post(route("nfc-cards.unassign"),{ids:r});o.success(e.data.message),h.reload({only:["nfcCards","employeeCards"]}),l([]),typeof refreshTable=="function"&&refreshTable()}catch(e){console.error("Unassign failed:",e),o.error(e.response?.data?.message||"Failed to unassign NFC cards.")}finally{f(!1)}};return console.log("Emp: ",i),s.jsxs(z,{children:[s.jsx(H,{title:"NFC-Card management"}),s.jsx("div",{className:"py-4 md:px-6 px-4 flex flex-col gap-6",children:N?s.jsx("div",{className:"space-y-5",children:s.jsxs("div",{className:"py-4 md:px-6 px-4 rounded-[14px] bg-white flex flex-col gap-3 space-y-3",children:[s.jsxs("div",{className:"relative mb-2",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[s.jsx(B,{onClick:()=>S("AddNfcCardModal"),variant:"primary",children:"Add Cards"}),s.jsxs(j,{align:"left",button:s.jsxs("div",{className:"flex items-center py-[9px] gap-2 cursor-pointer px-4 rounded-md border border-gray-500 text-sm",children:[s.jsx("span",{children:"Bulk actions"}),s.jsx(U,{className:"h-5 w-5"})]}),children:[s.jsx(p,{onClick:()=>C("active"),disabled:!r.length||d,children:"Set Active"}),s.jsx(p,{onClick:()=>C("inactive"),disabled:!r.length||d,children:"Set Inactive"}),s.jsx(p,{onClick:()=>{if(!r.length||d||!i)return;window.confirm("Are you sure you want to assign these cards? This action cannot be undone.")&&D()},disabled:!r.length||d||!i,children:"Assign Card(s)"}),s.jsx(p,{onClick:()=>{if(!r.length||d)return;window.confirm("Are you sure you want to unassign these cards? This action cannot be undone.")&&E()},disabled:!r.length||d,children:"Unassign Card(s)"})]}),s.jsx("div",{className:"w-[280px] max-w-full",children:s.jsx(O,{id:"employee",isSearchable:!0,placeholder:"Select or search employee...",name:"employee",value:i,onChange:e=>{T(e.target.value)},className:"w-full block",async:!0,loadOptions:e=>(console.log("Searching for: ",e),g.get(route("company.employees.search"),{params:{q:e}}).then(a=>(console.log("Search results: ",a.data),a.data.map(t=>({value:t.value,label:t.label,icon:()=>s.jsx("img",{src:t.image,alt:t.label,className:"h-6 w-6 rounded-full"})})))).catch(a=>(console.error("Search error: ",a),[])))})})]}),r.length>0?s.jsxs("p",{className:"text-sm text-primary top-full left-0 absolute mt-1",children:[r.length," card(s) selected"]}):null]}),s.jsx(L,{columns:I,data:m,endpoint:route("company.nfc_cards"),tableKey:"nfcCards",searchable:!0,paginated:!0,perPageOptions:[10,25,50,100],selectable:!0,selectedIds:r,onSelectionChange:l,emptyMessage:"No NFC cards found."})]})}):s.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-md",children:"You can only access this page with a valid subscription. Contact Admin for more information."})})]})}export{Z as default};
