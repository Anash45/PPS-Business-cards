import{u as q,a as B,r as l,j as t,H,S as M,D as R,b as x,z as o,d as b}from"./app-CTCImK6X.js";import{A as z}from"./AuthenticatedLayout-CMVoBH1l.js";import{E as A,D as U}from"./dataTables.dataTables-CC_VCcgF.js";import{D as j,a as m}from"./DropdownUi-D5HsVi_Q.js";import{g as G}from"./viteConfig-gEqUb4HH.js";import{C as O}from"./chevron-down-euuG9Awp.js";import"./ApplicationLogo-DUbHNqJR.js";A.use(U);function se(){const{nfcCards:y,employeeCards:N,isSubscriptionActive:S}=q().props,{setHeaderTitle:E,setHeaderText:T}=B(),[g,I]=l.useState("https://app.ppsbusinesscards.de");l.useEffect(()=>{(async()=>{const e=await G();I(e)})()},[]),l.useEffect(()=>{E("NFC Cards Management"),T("")},[]);const $=(e,n,a)=>{const s=document.createElement("div");return setTimeout(()=>{R.createRoot(s).render(t.jsx(j,{children:t.jsx(m,{onClick:()=>D(a.id,a.status),children:a.status==="active"?"Set Inactive":"Set Active"})}))},0),s};console.log("nfcCards: ",y);const D=async(e,n)=>{const a=n==="active"?"inactive":"active";if(confirm(`Are you sure you want to set this card as ${a}?`))try{const s=await x.put(`/nfc-cards/${e}/toggle-status`,{status:a});s.data?.success?(o.success(s.data.message||"Card status updated successfully."),b.reload({only:["nfcCards"]}),d([])):o.error(s.data?.message||"Failed to update card status.")}catch(s){if(s.response&&s.response.data){const c=s.response.data;c.message?o.error(c.message):c.errors?Object.values(c.errors).forEach(i=>{o.error(i)}):o.error("An unexpected error occurred.")}else o.error("Network error or server is unreachable.")}},[Y,v]=l.useState(!1),[r,d]=l.useState([]),[u,_]=l.useState(null),F=l.useMemo(()=>[{title:'<input type="checkbox" id="select-all" /> ID',data:"id",orderable:!1,render:(e,n,a)=>{const s=r.includes(a.id);return`
        <div class="flex items-center gap-2">
            <input type="checkbox" 
                   class="row-checkbox" 
                   value="${a.id}" 
                   ${s?"checked":""} />
            <span>${a.id}</span>
        </div>
    `}},{title:"Code",data:"qr_code",render:(e,n,a)=>`<a href="${g}/card/${a.qr_code}" target="_blank" class="text-[#50bd5b] underline">${e}</a>`},{title:"Employee",data:null,render:(e,n,a)=>{const s=a.card;if(!s)return'<p class="text-sm text-gray-400">Not assigned</p>';const i=[s.salutation,s.title,s.first_name,s.last_name].filter(Boolean).join(" ");return`
        <div class="flex items-center gap-2">
            <img
                src="${s.profile_image?`/storage/${s.profile_image}`:"/assets/images/profile-placeholder.png"}"
                alt="Profile"
                class="rounded-full border-2 bg-white border-white w-8 h-8 object-cover shrink-0"
            />
            <div>
                <p class="font-medium text-[#181D27] text-sm">
                    ${i||"Not assigned"}
                </p>
            </div>
        </div>
        `}},{title:"Status",data:"status",render:e=>{const n=e==="active";return`<span class="px-2 py-1 text-xs font-medium rounded-full ${n?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"}">
                    ${n?"Active":"Inactive"}
                </span>`}},{title:"Actions",data:null,orderable:!1,searchable:!1,render:$}],[g]);l.useEffect(()=>{const e=document.getElementById("select-all");if(!e)return;const n=s=>{const c=s.target.checked,i=document.querySelectorAll(".row-checkbox"),p=[];i.forEach(k=>{k.checked=c,c&&p.push(parseInt(k.value))}),d(c?p:[]),v(c)},a=()=>{const s=document.querySelectorAll(".row-checkbox"),c=Array.from(document.querySelectorAll(".row-checkbox:checked")),i=c.map(p=>parseInt(p.value));e.checked=c.length===s.length,d(i),v(i.length>0)};return e.addEventListener("change",n),document.addEventListener("change",s=>{s.target.classList.contains("row-checkbox")&&a()}),()=>{e.removeEventListener("change",n)}},[g]);const[f,C]=l.useState(!1),[J,h]=l.useState(!1),w=async e=>{if(!r.length){o.warning("Please select at least one card.");return}console.log("selectedIds: ",r),C(!0);try{const n=await x.post("/nfc-cards/toggle-multiple-status",{ids:r,status:e});o.success(n.data.message),b.reload({only:["nfcCards"]}),d([]),typeof refreshTable=="function"&&refreshTable()}catch(n){console.error("Toggle failed:",n);const a=n.response?.data?.message||"Failed to update status.";o.error(a)}finally{C(!1)}},P=async()=>{if(!r.length){o.warning("Please select at least one NFC card.");return}if(!u){o.warning("Please select an employee.");return}h(!0);try{const e=await x.post(route("nfc-cards.assign"),{ids:r,employee:u});o.success(e.data.message),b.reload({only:["nfcCards","employeeCards"]}),d([]),typeof refreshTable=="function"&&refreshTable()}catch(e){console.error("Assign failed:",e),o.error(e.response?.data?.message||"Failed to assign NFC cards.")}finally{h(!1)}},L=async()=>{if(!r.length){o.warning("Please select at least one NFC card.");return}h(!0);try{const e=await x.post(route("nfc-cards.unassign"),{ids:r});o.success(e.data.message),b.reload({only:["nfcCards","employeeCards"]}),d([]),typeof refreshTable=="function"&&refreshTable()}catch(e){console.error("Unassign failed:",e),o.error(e.response?.data?.message||"Failed to unassign NFC cards.")}finally{h(!1)}};return console.log("Emp: ",u),t.jsxs(z,{children:[t.jsx(H,{title:"Cards"}),t.jsx("div",{className:"py-4 md:px-6 px-4 flex flex-col gap-6",children:S?t.jsx("div",{className:"space-y-5",children:t.jsxs("div",{className:"py-4 md:px-6 px-4 rounded-[14px] bg-white flex flex-col gap-3 space-y-3",children:[t.jsxs("div",{className:"relative mb-2",children:[t.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[t.jsxs(j,{align:"left",button:t.jsxs("div",{className:"flex items-center py-[9px] gap-2 cursor-pointer px-4 rounded-md border border-gray-500 text-sm",children:[t.jsx("span",{children:"Bulk actions"}),t.jsx(O,{className:"h-5 w-5"})]}),children:[t.jsx(m,{onClick:()=>w("active"),disabled:!r.length||f,children:"Set Active"}),t.jsx(m,{onClick:()=>w("inactive"),disabled:!r.length||f,children:"Set Inactive"}),t.jsx(m,{onClick:()=>{if(!r.length||f||!u)return;window.confirm("Are you sure you want to assign these cards? This action cannot be undone.")&&P()},disabled:!r.length||f||!u,children:"Assign Card(s)"}),t.jsx(m,{onClick:()=>{if(!r.length||f)return;window.confirm("Are you sure you want to unassign these cards? This action cannot be undone.")&&L()},disabled:!r.length||f,children:"Unassign Card(s)"})]}),t.jsx("div",{className:"min-w-[200px]",children:t.jsx(M,{id:"employee",name:"employee",value:u,onChange:e=>{_(e.target.value)},className:"w-full block",options:N.map(e=>({value:e.id,label:[e.id,e.salutation,e.title,e.first_name,e.last_name].filter(Boolean).join(" ")||"Not assigned"}))})})]}),r.length>0?t.jsxs("p",{className:"text-sm text-primary top-full left-0 absolute mt-1",children:[r.length," card(s) selected"]}):null]}),t.jsx(A,{data:y,columns:F,className:"display site-datatable",options:{responsive:!0,pageLength:10,lengthMenu:[10,25,50,100],dom:"<'flex justify-between items-center mb-3 sd-top'<'flex items-center gap-2'l><'flex items-center gap-2'f>>rt<'flex justify-center mt-3 sd-bottom'p>"}},g)]})}):t.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-md",children:"You can only access this page with a valid subscription. Contact Admin for more information."})})]})}export{se as default};
