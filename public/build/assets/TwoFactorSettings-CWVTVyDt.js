import{u as y,r as u,A as T,j as e,C as l,I as C,T as S,B as _,b as n,z as s,d as c}from"./app-B8v70Kz_.js";function D({className:g=""}){const i=y().props.auth.user,[h,d]=u.useState(y().props.totp_qr||null),[t,r]=u.useState(!1),[p,b]=u.useState(null),{data:x,setData:f,errors:j,setError:m,reset:A}=T({code:""});console.log(i);const N=async()=>{r(!0);try{await n.post("/two-factor/email/enable"),s.success("Email 2FA enabled."),c.reload({only:["auth"]})}catch(a){console.error(a),s.error("Failed to enable Email 2FA.")}finally{r(!1)}},w=async()=>{r(!0);try{await n.post("/two-factor/email/disable"),s.success("Email 2FA disabled."),c.reload({only:["auth"]})}catch(a){console.error(a),s.error("Failed to disable Email 2FA.")}finally{r(!1)}},E=async()=>{r(!0);try{const a=await n.post("/two-factor/totp/start");d(a.data.totp_qr),s.success(a.data.message),b(a.data.secret)}catch(a){console.error(a),s.error("Failed to start TOTP setup.")}finally{r(!1)}},F=async()=>{r(!0);try{await n.post("/two-factor/totp/disable"),d(null),s.success("Authenticator App 2FA disabled."),c.reload({only:["auth"]})}catch(a){console.error(a),s.error("Failed to disable TOTP.")}finally{r(!1)}},v=async a=>{a.preventDefault(),r(!0),m("code",null);try{const o=await n.post("/two-factor/totp/verify",{code:x.code});s.success(o.data.message),d(null),A("code"),c.reload({only:["auth"]})}catch(o){o.response?.data?.message?(m("code",o.response.data.message),s.error(o.response.data.message)):(m("code","Something went wrong."),s.error("Something went wrong."))}finally{r(!1)}};return e.jsxs("section",{className:g,children:[e.jsxs("header",{children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Two-Factor Authentication"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Improve your account security by enabling 2FA."})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"border p-4 rounded-md",children:[e.jsx("h3",{className:"font-semibold",children:"Email Authentication"}),e.jsx("p",{className:"text-sm text-gray-600",children:"A 6-digit code will be emailed to you at login."}),i.is_email_2fa_enabled?e.jsx(l,{variant:"danger",className:"mt-3",onClick:w,disabled:t,children:t?"Processing...":"Disable Email 2FA"}):e.jsx(l,{className:"mt-3",onClick:N,disabled:t,children:t?"Processing...":"Enable Email 2FA"})]}),e.jsxs("div",{className:"border p-4 rounded-md",children:[e.jsx("h3",{className:"font-semibold",children:"Authenticator App"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Use Google Authenticator or Microsoft Authenticator."}),i.is_totp_2fa_enabled?e.jsx(l,{variant:"danger",className:"mt-3",onClick:F,disabled:t,children:t?"Processing...":"Disable Authenticator App"}):e.jsx(l,{className:"mt-3",onClick:E,disabled:t,children:t?"Generating QR...":"Enable Authenticator App"}),h&&e.jsxs("div",{className:"mt-4",children:[e.jsx("img",{src:h,alt:"QR Code",className:"w-48 h-48"}),p&&e.jsxs("p",{className:"mt-2 text-sm text-gray-700",children:["Or enter this key manually in your authenticator app: ",e.jsx("br",{}),e.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:p})]}),e.jsxs("form",{onSubmit:v,className:"mt-4",children:[e.jsx(C,{value:"Enter code from your app"}),e.jsx(S,{value:x.code,onChange:a=>f("code",a.target.value),className:"mt-2 block w-full"}),e.jsx(_,{message:j.code}),e.jsx(l,{className:"mt-3",disabled:t,children:t?"Verifying...":"Verify"})]})]})]})]})]})}export{D as default};
