import{r as d,j as a,B as y,b as j,c as w,H as C,d as D,e as S,z as i,f as A}from"./app-C0ddo5LU.js";import{A as E}from"./AuthenticatedLayout-uW_qQG5P.js";import{E as h,D as k}from"./dataTables.dataTables-DQzxVgMs.js";import{D as $,a as b}from"./DropdownUi-C_etOdOK.js";import{g as N}from"./viteConfig-BIBuROsR.js";import{c as L}from"./csvFieldDefinitions-CmBVwms9.js";import"./ApplicationLogo-BmD6zMRB.js";function R({cards:c}){const[l,u]=d.useState(!1),m=async()=>{if(c?.length){u(!0);try{const n=L.map(s=>s.name),f=c.map(s=>n.map((r,o)=>o===0&&s.code||"")),x=[n.join(","),...f.map(s=>s.map(e=>`"${e}"`).join(","))].join(`
`),g=new Blob([x],{type:"text/csv;charset=utf-8;"}),p=URL.createObjectURL(g),t=document.createElement("a");t.href=p,t.download="base_sample.csv",t.click(),URL.revokeObjectURL(p)}catch(n){console.error("CSV generation failed:",n)}finally{u(!1)}}};return a.jsx("div",{className:"flex justify-end",children:a.jsx(y,{onClick:m,disabled:l,children:l?"Saving...":"Download Base CSV"})})}h.use(k);function O(){const{cards:c,isSubscriptionActive:l}=j().props,{setHeaderTitle:u,setHeaderText:m}=w(),[n,f]=d.useState("https://app.ppsbusinesscards.de");d.useEffect(()=>{(async()=>{const t=await N();f(t),console.log("asdsad",t)})()},[]),d.useEffect(()=>{u("Cards Management"),m("")},[]);const x=(t,s,e)=>{const r=document.createElement("div");return setTimeout(()=>{D.createRoot(r).render(a.jsxs($,{children:[a.jsx(b,{onClick:()=>window.location.href=`/company/cards/${e.id}/edit`,children:"Edit"}),a.jsx(b,{onClick:()=>g(e.id,e.status),children:e.status==="active"?"Set Inactive":"Set Active"})]}))},0),r},g=async(t,s)=>{const e=s==="active"?"inactive":"active";if(confirm(`Are you sure you want to set this card as ${e}?`))try{const r=await S.put(`/cards/${t}/toggle-status`,{status:e});r.data?.success?(i.success(r.data.message||"Card status updated successfully."),A.reload({only:["cards"]})):i.error(r.data?.message||"Failed to update card status.")}catch(r){if(r.response&&r.response.data){const o=r.response.data;o.message?i.error(o.message):o.errors?Object.values(o.errors).forEach(v=>{i.error(v)}):i.error("An unexpected error occurred.")}else i.error("Network error or server is unreachable.")}},p=d.useMemo(()=>[{title:"ID",data:"id"},{title:"Code",data:"code",render:(t,s,e)=>`<a href="${n}/card/${t}" target="_blank" class="text-[#50bd5b] underline">${t}</a>`},{title:"Name",data:null,render:(t,s,e)=>[e.salutation,e.title,e.first_name,e.last_name].filter(Boolean).join(" ")},{title:"Position",data:"position"},{title:"Department",data:"department"},{title:"Status",data:"status",render:t=>{const s=t==="active";return`<span class="px-2 py-1 text-xs font-medium rounded-full ${s?"bg-green-100 text-green-700 border border-green-200":"bg-gray-100 text-gray-700 border border-gray-200"}">${s?"Active":"Inactive"}</span>`}},{title:"Actions",data:null,orderable:!1,searchable:!1,render:x}],[n]);return a.jsxs(E,{children:[a.jsx(C,{title:"Cards"}),a.jsxs("div",{className:"py-4 md:px-6 px-4 flex flex-col gap-6",children:[a.jsx(R,{cards:c}),l?a.jsx("div",{className:"space-y-5",children:a.jsx("div",{className:"py-4 md:px-6 px-4 rounded-[14px] bg-white flex flex-col gap-3",children:a.jsx(h,{data:c,columns:p,className:"display site-datatable",options:{responsive:!0,pageLength:10,lengthMenu:[10,25,50,100],dom:"<'flex justify-between items-center mb-3 sd-top'<'flex items-center gap-2'l><'flex items-center gap-2'f>>rt<'flex justify-center mt-3 sd-bottom'p>"}},n)})}):a.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-md",children:"You can only access this page with a valid subscription. Contact Admin for more information."})]})]})}export{O as default};
