import{b as B,c as R,r as o,j as n,H as P,B as p,d as U,e as m,z as l,f as w}from"./app-CCAMJvLX.js";import{A as H}from"./AuthenticatedLayout-DhX8MKy_.js";import{E as S,D as M}from"./dataTables.dataTables-oY0RMSve.js";import{D as q,a as j}from"./DropdownUi-D3iwncWt.js";import{g as F}from"./viteConfig-BIBuROsR.js";import{c as O}from"./csvFieldDefinitions-_yPXnvkW.js";import"./ApplicationLogo-DhvltECZ.js";S.use(M);function W(){const{cards:f,isSubscriptionActive:C}=B().props,{setHeaderTitle:A,setHeaderText:E}=R(),[d,D]=o.useState("https://app.ppsbusinesscards.de");o.useEffect(()=>{(async()=>{const t=await F();D(t),console.log("asdsad",t)})()},[]),o.useEffect(()=>{A("Cards Management"),E("")},[]);const $=(t,a,e)=>{const s=document.createElement("div");return setTimeout(()=>{U.createRoot(s).render(n.jsxs(q,{children:[n.jsx(j,{onClick:()=>window.location.href=`/company/cards/${e.id}/edit`,children:"Edit"}),n.jsx(j,{onClick:()=>I(e.id,e.status),children:e.status==="active"?"Set Inactive":"Set Active"})]}))},0),s},I=async(t,a)=>{const e=a==="active"?"inactive":"active";if(confirm(`Are you sure you want to set this card as ${e}?`))try{const s=await m.put(`/cards/${t}/toggle-status`,{status:e});s.data?.success?(l.success(s.data.message||"Card status updated successfully."),w.reload({only:["cards"]})):l.error(s.data?.message||"Failed to update card status.")}catch(s){if(s.response&&s.response.data){const r=s.response.data;r.message?l.error(r.message):r.errors?Object.values(r.errors).forEach(i=>{l.error(i)}):l.error("An unexpected error occurred.")}else l.error("Network error or server is unreachable.")}},[L,h]=o.useState(!1),[c,g]=o.useState([]),N=o.useMemo(()=>[{title:'<input type="checkbox" id="select-all" /> ID',data:"id",orderable:!1,render:(t,a,e)=>{const s=c.includes(e.id);return`
        <div class="flex items-center gap-2">
            <input type="checkbox" 
                   class="row-checkbox" 
                   value="${e.id}" 
                   ${s?"checked":""} />
            <span>${e.id}</span>
        </div>
    `}},{title:"Code",data:"code",render:(t,a,e)=>`<a href="${d}/card/${t}" target="_blank" class="text-[#50bd5b] underline">${t}</a>`},{title:"User",data:null,render:(t,a,e)=>{const r=[e.salutation,e.title,e.first_name,e.last_name].filter(Boolean).join(" ");return`
                    <div class="flex items-center gap-2">
                        <img
                            src="${e.profile_image?`/storage/${e.profile_image}`:"/assets/images/profile-placeholder.png"}"
                            alt="Profile"
                            class="rounded-full border-2 bg-white border-white w-8 h-8 object-cover shrink-0"
                        />
                        <div>
                            <p class="font-medium text-[#181D27] text-sm">
                                ${r||"Not assigned"}
                            </p>
                        </div>
                    </div>
                `}},{title:"Position",data:"position"},{title:"Department",data:"department"},{title:"Status",data:"status",render:t=>{const a=t==="active";return`<span class="px-2 py-1 text-xs font-medium rounded-full ${a?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"}">
                    ${a?"Active":"Inactive"}
                </span>`}},{title:"Actions",data:null,orderable:!1,searchable:!1,render:$}],[d]);o.useEffect(()=>{const t=document.getElementById("select-all");if(!t)return;const a=s=>{const r=s.target.checked,i=document.querySelectorAll(".row-checkbox"),u=[];i.forEach(k=>{k.checked=r,r&&u.push(parseInt(k.value))}),g(r?u:[]),h(r)},e=()=>{const s=document.querySelectorAll(".row-checkbox"),r=Array.from(document.querySelectorAll(".row-checkbox:checked")),i=r.map(u=>parseInt(u.value));t.checked=r.length===s.length,g(i),h(i.length>0)};return t.addEventListener("change",a),document.addEventListener("change",s=>{s.target.classList.contains("row-checkbox")&&e()}),()=>{t.removeEventListener("change",a)}},[d]);const[T,x]=o.useState(!1),_=async()=>{if(!(!f?.length||!c?.length)){x(!0);try{const t=await m.post("/cards/download",{selected_ids:c,csv_fields:O.map(r=>r.name)},{responseType:"blob"}),a=new Blob([t.data],{type:"text/csv;charset=utf-8;"}),e=window.URL.createObjectURL(a),s=document.createElement("a");s.href=e,s.download="base_sample.csv",s.click(),window.URL.revokeObjectURL(e)}catch(t){console.error("CSV download failed:",t)}finally{x(!1)}}},[b,v]=o.useState(!1),y=async t=>{if(!c.length){l.warning("Please select at least one card.");return}v(!0);try{const a=await m.post("/cards/toggle-multiple-status",{ids:c,status:t});l.success(a.data.message),w.reload({only:["cards"]}),typeof refreshTable=="function"&&refreshTable()}catch(a){console.error("Toggle failed:",a);const e=a.response?.data?.message||"Failed to update status.";l.error(e)}finally{v(!1)}};return n.jsxs(H,{children:[n.jsx(P,{title:"Cards"}),n.jsx("div",{className:"py-4 md:px-6 px-4 flex flex-col gap-6",children:C?n.jsx("div",{className:"space-y-5",children:n.jsxs("div",{className:"py-4 md:px-6 px-4 rounded-[14px] bg-white flex flex-col gap-3 space-y-3",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[n.jsx(p,{onClick:()=>y("active"),disabled:!c.length||b,variant:"primary-outline",children:"Set Active"}),n.jsx(p,{onClick:()=>y("inactive"),disabled:!c.length||b,variant:"danger-outline",children:"Set Inactive"}),n.jsx(p,{onClick:_,variant:"light",disabled:!L,children:T?"Saving...":"Download Base CSV"})]}),c.length>0?n.jsxs("p",{className:"text-sm text-primary",children:[c.length," cards selected"]}):null]}),n.jsx(S,{data:f,columns:N,className:"display site-datatable",options:{responsive:!0,pageLength:10,lengthMenu:[10,25,50,100],dom:"<'flex justify-between items-center mb-3 sd-top'<'flex items-center gap-2'l><'flex items-center gap-2'f>>rt<'flex justify-center mt-3 sd-bottom'p>"}},d)]})}):n.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-md",children:"You can only access this page with a valid subscription. Contact Admin for more information."})})]})}export{W as default};
