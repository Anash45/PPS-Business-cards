import{u as L,a as q,r as l,j as a,H as B,C as m,S as H,D as M,b as h,z as n,d as x}from"./app-CGFzd2TY.js";import{A as R}from"./AuthenticatedLayout-BCMy8k8B.js";import{E as w,D as z}from"./dataTables.dataTables-g9G_zO2f.js";import{D as U,a as G}from"./DropdownUi-DgnfSv-z.js";import{g as O}from"./viteConfig-BIBuROsR.js";import"./ApplicationLogo-3F04g8Vp.js";w.use(z);function ee(){const{nfcCards:y,employeeCards:A,isSubscriptionActive:N}=L().props,{setHeaderTitle:S,setHeaderText:E}=q(),[p,I]=l.useState("https://app.ppsbusinesscards.de");l.useEffect(()=>{(async()=>{const e=await O();I(e)})()},[]),l.useEffect(()=>{S("NFC Cards Management"),E("")},[]);const T=(e,r,t)=>{const s=document.createElement("div");return setTimeout(()=>{M.createRoot(s).render(a.jsx(U,{children:a.jsx(G,{onClick:()=>$(t.id,t.status),children:t.status==="active"?"Set Inactive":"Set Active"})}))},0),s};console.log("nfcCards: ",y);const $=async(e,r)=>{const t=r==="active"?"inactive":"active";if(confirm(`Are you sure you want to set this card as ${t}?`))try{const s=await h.put(`/nfc-cards/${e}/toggle-status`,{status:t});s.data?.success?(n.success(s.data.message||"Card status updated successfully."),x.reload({only:["nfcCards"]})):n.error(s.data?.message||"Failed to update card status.")}catch(s){if(s.response&&s.response.data){const o=s.response.data;o.message?n.error(o.message):o.errors?Object.values(o.errors).forEach(i=>{n.error(i)}):n.error("An unexpected error occurred.")}else n.error("Network error or server is unreachable.")}},[Y,b]=l.useState(!1),[c,v]=l.useState([]),[d,D]=l.useState(null),_=l.useMemo(()=>[{title:'<input type="checkbox" id="select-all" /> ID',data:"id",orderable:!1,render:(e,r,t)=>{const s=c.includes(t.id);return`
        <div class="flex items-center gap-2">
            <input type="checkbox" 
                   class="row-checkbox" 
                   value="${t.id}" 
                   ${s?"checked":""} />
            <span>${t.id}</span>
        </div>
    `}},{title:"Code",data:"qr_code",render:(e,r,t)=>`<a href="${p}/card/${t.qr_code}" target="_blank" class="text-[#50bd5b] underline">${e}</a>`},{title:"Employee",data:null,render:(e,r,t)=>{const s=t.card;if(!s)return'<p class="text-sm text-gray-400">Not assigned</p>';const i=[s.salutation,s.title,s.first_name,s.last_name].filter(Boolean).join(" ");return`
        <div class="flex items-center gap-2">
            <img
                src="${s.profile_image?`/storage/${s.profile_image}`:"/assets/images/profile-placeholder.png"}"
                alt="Profile"
                class="rounded-full border-2 bg-white border-white w-8 h-8 object-cover shrink-0"
            />
            <div>
                <p class="font-medium text-[#181D27] text-sm">
                    ${i||"Not assigned"}
                </p>
            </div>
        </div>
        `}},{title:"Status",data:"status",render:e=>{const r=e==="active";return`<span class="px-2 py-1 text-xs font-medium rounded-full ${r?"bg-green-100 text-green-700 border border-green-200":"bg-red-100 text-red-700 border border-red-200"}">
                    ${r?"Active":"Inactive"}
                </span>`}},{title:"Actions",data:null,orderable:!1,searchable:!1,render:T}],[p]);l.useEffect(()=>{const e=document.getElementById("select-all");if(!e)return;const r=s=>{const o=s.target.checked,i=document.querySelectorAll(".row-checkbox"),u=[];i.forEach(j=>{j.checked=o,o&&u.push(parseInt(j.value))}),v(o?u:[]),b(o)},t=()=>{const s=document.querySelectorAll(".row-checkbox"),o=Array.from(document.querySelectorAll(".row-checkbox:checked")),i=o.map(u=>parseInt(u.value));e.checked=o.length===s.length,v(i),b(i.length>0)};return e.addEventListener("change",r),document.addEventListener("change",s=>{s.target.classList.contains("row-checkbox")&&t()}),()=>{e.removeEventListener("change",r)}},[p]);const[f,C]=l.useState(!1),[J,g]=l.useState(!1),k=async e=>{if(!c.length){n.warning("Please select at least one card.");return}console.log("selectedIds: ",c),C(!0);try{const r=await h.post("/nfc-cards/toggle-multiple-status",{ids:c,status:e});n.success(r.data.message),x.reload({only:["nfcCards"]}),typeof refreshTable=="function"&&refreshTable()}catch(r){console.error("Toggle failed:",r);const t=r.response?.data?.message||"Failed to update status.";n.error(t)}finally{C(!1)}},F=async()=>{if(!c.length){n.warning("Please select at least one NFC card.");return}if(!d){n.warning("Please select an employee.");return}g(!0);try{const e=await h.post(route("nfc-cards.assign"),{ids:c,employee:d});n.success(e.data.message),x.reload({only:["nfcCards","employeeCards"]}),typeof refreshTable=="function"&&refreshTable()}catch(e){console.error("Assign failed:",e),n.error(e.response?.data?.message||"Failed to assign NFC cards.")}finally{g(!1)}},P=async()=>{if(!c.length){n.warning("Please select at least one NFC card.");return}g(!0);try{const e=await h.post(route("nfc-cards.unassign"),{ids:c});n.success(e.data.message),x.reload({only:["nfcCards","employeeCards"]}),typeof refreshTable=="function"&&refreshTable()}catch(e){console.error("Unassign failed:",e),n.error(e.response?.data?.message||"Failed to unassign NFC cards.")}finally{g(!1)}};return console.log("Emp: ",d),a.jsxs(R,{children:[a.jsx(B,{title:"Cards"}),a.jsx("div",{className:"py-4 md:px-6 px-4 flex flex-col gap-6",children:N?a.jsx("div",{className:"space-y-5",children:a.jsxs("div",{className:"py-4 md:px-6 px-4 rounded-[14px] bg-white flex flex-col gap-3 space-y-3",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[a.jsx(m,{onClick:()=>k("active"),disabled:!c.length||f,variant:"primary-outline",children:"Set Active"}),a.jsx(m,{onClick:()=>k("inactive"),disabled:!c.length||f,variant:"danger-outline",children:"Set Inactive"}),a.jsx("div",{className:"min-w-[200px]",children:a.jsx(H,{id:"employee",name:"employee",value:d,onChange:e=>{D(e.target.value)},className:"w-full block",options:A.map(e=>({value:e.id,label:[e.id,e.salutation,e.title,e.first_name,e.last_name].filter(Boolean).join(" ")||"Not assigned"}))})}),a.jsx(m,{onClick:()=>F(),disabled:!c.length||f||!d,variant:"primary",children:"Assign Card(s)"}),a.jsx(m,{onClick:()=>P(),disabled:!c.length||f,variant:"danger",children:"Unassign Card(s)"})]}),c.length>0?a.jsxs("p",{className:"text-sm text-primary",children:[c.length," cards selected"]}):null]}),a.jsx(w,{data:y,columns:_,className:"display site-datatable",options:{responsive:!0,pageLength:10,lengthMenu:[10,25,50,100],dom:"<'flex justify-between items-center mb-3 sd-top'<'flex items-center gap-2'l><'flex items-center gap-2'f>>rt<'flex justify-center mt-3 sd-bottom'p>"}},p)]})}):a.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-md",children:"You can only access this page with a valid subscription. Contact Admin for more information."})})]})}export{ee as default};
